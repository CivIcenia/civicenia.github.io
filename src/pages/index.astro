---
import { getCollection } from "astro:content";
import DefaultLayout from "@layouts/default.astro";
import { Strings, Arrays } from "@helpers";
import { PERMALINK_ROOTS } from "@comptime";

const BASE = (import.meta.env.BASE_URL ?? "/");

// Get recent news items for the ticker (limit to 5 most recent)
const allNews = await getCollection("news");
const recentNews = allNews
    .sort(Arrays.sortByDate((entry) => entry.data.date))
    .reverse()
    .slice(0, 5);
---

<DefaultLayout 
    title="The Third Republic of Icenia"
    description="Welcome to the Third Republic of Icenia, a semi-democratic republic in the -,- quadrant."
>

    <!-- Hero Section -->
    <section class="icenia-hero">
        <h1>Welcome to Icenia!</h1>
        <p class="icenia-hero-subtitle">The Third Republic of Icenia welcomes you to the -,-.</p>
        <div class="icenia-hero-actions">
            <a href={BASE + "guide/"} class="icenia-btn">Become a Citizen</a>
            <a href="https://map.civmc.tk/" target="_blank" class="icenia-btn icenia-btn-secondary">View the Map</a>
        </div>
    </section>

    <!-- News Ticker -->
    <div class="govuk-width-container">
        <main class="govuk-main-wrapper">
            <div class="govuk-grid-row">
                <div class="govuk-grid-column-full">
                    <div class="news-ticker">
                        <h3 class="govuk-heading-m">üì∞ Recent News</h3>
                        {recentNews.map((entry) => (
                            <div class="news-ticker-item">
                                <a href={PERMALINK_ROOTS.news + entry.slug} class="govuk-link">
                                    {entry.data.headline}
                                </a>
                                <span class="news-ticker-date"> - {Strings.formatDate(entry.data.date, "mmmm yyyy")}</span>
                            </div>
                        ))}
                    </div>
                </div>
            </div>
            <!-- Content Grid (equal-height cards) -->
            <div class="equal-cards">
                <div class="govuk-grid-row">
                    <div class="govuk-grid-column-one-half">
                        <!-- Card 1: The Republic -->
                        <div class="icenia-card">
                            <h3 class="govuk-heading-m">üèõÔ∏è The Republic</h3>
                            <p class="govuk-body">
                                From the cityscapes of Icenia City, to of tropical beaches of <strong>Icarus</strong> 
                                and the rivers of <strong>Cortesia Del Mar</strong>, Icenia stands united. 
                                Explore our diverse states and territories.
                            </p>
                            <a href={BASE + "union/"} class="govuk-link govuk-!-font-weight-bold">Explore States ‚Üí</a>
                        </div>
                    </div>

                    <div class="govuk-grid-column-one-half">
                        <!-- Card 2: Government -->
                        <div class="icenia-card">
                            <h3 class="govuk-heading-m">‚öñÔ∏è Government</h3>
                            <p class="govuk-body">
                                Icenia is a Semi-Democratic Republic. Our democratically voted <strong>Senate</strong> meets regularly to pass 
                                legislation. Led by President <strong>ChrisChrispie</strong>, we strive for transparent and 
                                accountable governance.
                            </p>
                            <a href={BASE + "government/officials/"} class="govuk-link govuk-!-font-weight-bold">View Officials ‚Üí</a>
                        </div>
                    </div>
                </div>

                <div class="govuk-grid-row">
                    <div class="govuk-grid-column-one-half">
                        <!-- Card 3: Diplomacy -->
                        <div class="icenia-card">
                            <h3 class="govuk-heading-m">‚öñÔ∏è Legislation</h3>
                            <p class="govuk-body">
                                Icenia is governed by a clear body of laws and a written constitution that ensure due process,
                                accountability, and the rights of citizens. Find our constitution, statutes, international treaties and legal framework here.
                            </p>
                            <a href={BASE + "laws/"} class="govuk-link govuk-!-font-weight-bold">View Laws & Constitution ‚Üí</a>
                        </div>
                    </div>

                    <div class="govuk-grid-column-one-half">
                        <!-- Card 4: Economy -->
                        <div class="icenia-card">
                            <h3 class="govuk-heading-m">üí∞ Economy</h3>
                            <p class="govuk-body">
                                Icenia boasts a thriving economy centered in Icenia City. 
                                From the server-renowned <strong>Enron Exchange</strong> to XP production and shops, we're the economic heart of the -,- quadrant.
                            </p>
                            <a href={BASE + "shops/"} class="govuk-link govuk-!-font-weight-bold">UNDER CONSTRUCTION View Icenia Shops ‚Üí</a>
                        </div>
                    </div>
                </div>

                <div class="govuk-grid-row">
                    <div class="govuk-grid-column-one-half">
                        <!-- Card 5: Infrastructure -->
                        <div class="icenia-card">
                            <h3 class="govuk-heading-m">üèóÔ∏è Infrastructure</h3>
                            <p class="govuk-body">
                                With extensive iceroad and rail networks and publically operatable farms complexes such as <strong>Wholefoods</strong>, Icenia continues to grow and modernize.
                            </p>
                            <a href={"https://discord.gg/6qn4gSDUFN"} class="govuk-link govuk-!-font-weight-bold">Find Jobs ‚Üí</a>
                        </div>
                    </div>

                    <div class="govuk-grid-column-one-half">
                        <!-- Card 6: Join Us -->
                        <div class="icenia-card">
                            <h3 class="govuk-heading-m">üëã Join Us</h3>
                            <p class="govuk-body">
                                Whether you're a builder, miner, PvPer, coder, botter, shopkeeper, writer, lawmaker, or have any other interests or skills, Icenia has a role for you. Choose a citizenship tier, read the guide, and get involved ‚Äî jobs, resources, and events await.
                            </p>
                            <a href={BASE + "guide/"} class="govuk-link govuk-!-font-weight-bold">Citizenship Guide ‚Üí</a>
                        </div>
                    </div>
                </div>
            </div>

    <style>
        body {
            margin: 0;
            font-family: inherit; /* use govuk-frontend fonts */
            background-color: var(--off-white);
            color: var(--icenia-black);
        }

        a { transition: color 0.2s; }
    </style>
</DefaultLayout>
