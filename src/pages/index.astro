---
import { getCollection } from "astro:content";
import DefaultLayout from "@layouts/default.astro";
import { Strings, Arrays } from "@helpers";
import { PERMALINK_ROOTS } from "@comptime";
import { getBordersLink } from "@comptime";

const BASE = (import.meta.env.BASE_URL ?? "/");

// Get recent news items for the ticker (limit to 5 most recent)
const allNews = await getCollection("news");
const recentNews = allNews
    .sort(Arrays.sortByDate((entry) => entry.data.date))
    .reverse()
    .slice(0, 5);
---

<DefaultLayout 
    title="The Third Republic of Icenia"
    description="Welcome to the Third Republic of Icenia, a semi-democratic republic in the -,- quadrant."
>

    <!-- Hero Section -->
    <section class="icenia-hero">
        <h1>Welcome to Icenia!</h1>
        <p class="icenia-hero-subtitle">The Third Republic of Icenia welcomes you to the -,-.</p>
        <div class="icenia-hero-actions">
            <a href={BASE + "guide/"} class="icenia-btn">Become a Citizen</a>
            <a href={getBordersLink(Astro)} target="_blank" class="icenia-btn icenia-btn-tertiary">View the Map</a>
        </div>
        <div class="icenia-scroll-hint">
            <span>Scroll to explore</span>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 5v14M5 12l7 7 7-7"/>
            </svg>
        </div>
    </section>

    <!-- News Ticker -->
    <div class="govuk-width-container">
        <main class="govuk-main-wrapper">
            <div class="govuk-grid-row">
                <div class="govuk-grid-column-full">
                    <div class="news-ticker">
                        <h3 class="govuk-heading-m">üì∞ Recent News</h3>
                        {recentNews.map((entry) => (
                            <div class="news-ticker-item">
                                <a href={PERMALINK_ROOTS.news + entry.slug} class="govuk-link">
                                    {entry.data.headline}
                                </a>
                                <span class="news-ticker-date"> - {Strings.formatDate(entry.data.date, "mmmm yyyy")}</span>
                            </div>
                        ))}
                    </div>
                </div>
            </div>

            <!-- Services Grid - Modern Card Design -->
            <section class="home-services-section">
                <h2 class="govuk-heading-l icenia-section-title">Discover Icenia</h2>
                <p class="govuk-body-l icenia-section-intro">
                    Explore the diverse facets of the Third Republic.
                </p>
                
                <div class="icenia-services-grid">
                    <a href={BASE + "union/"} class="icenia-service-card">
                        <div class="icenia-service-icon">üèõÔ∏è</div>
                        <h3 class="icenia-service-title">The Republic</h3>
                        <p class="icenia-service-desc">
                            From the cityscapes of Icenia City, to the tropical beaches of Icarus 
                            and the rivers of Cortesia Del Mar. Explore our diverse states and territories.
                        </p>
                        <span class="icenia-service-link">Explore States ‚Üí</span>
                    </a>

                    <a href={BASE + "government/officials/"} class="icenia-service-card">
                        <div class="icenia-service-icon">‚öñÔ∏è</div>
                        <h3 class="icenia-service-title">Government</h3>
                        <p class="icenia-service-desc">
                            Icenia is a Semi-Democratic Republic. Our democratically elected Senate meets regularly, 
                            led by President ChrisChrispie with transparent governance.
                        </p>
                        <span class="icenia-service-link">View Officials ‚Üí</span>
                    </a>

                    <a href={BASE + "laws/"} class="icenia-service-card">
                        <div class="icenia-service-icon">üìú</div>
                        <h3 class="icenia-service-title">Legislation</h3>
                        <p class="icenia-service-desc">
                            Governed by clear laws and a written constitution ensuring due process, 
                            accountability, and rights for all citizens.
                        </p>
                        <span class="icenia-service-link">View Laws ‚Üí</span>
                    </a>

                    <a href={BASE + "icenia-city/shops/"} class="icenia-service-card">
                        <div class="icenia-service-icon">üí∞</div>
                        <h3 class="icenia-service-title">Economy</h3>
                        <p class="icenia-service-desc">
                            A thriving economy centered in Icenia City. Home to the server-renowned 
                            Enron Exchange ‚Äî the economic heart of the -,- quadrant.
                        </p>
                        <span class="icenia-service-link">View Shops ‚Üí</span>
                    </a>

                    <a href="https://discord.gg/6qn4gSDUFN" target="_blank" class="icenia-service-card">
                        <div class="icenia-service-icon">üèóÔ∏è</div>
                        <h3 class="icenia-service-title">Infrastructure</h3>
                        <p class="icenia-service-desc">
                            Extensive iceroad and rail networks and public farm complexes like 
                            Wholefoods. Icenia continues to grow and modernize.
                        </p>
                        <span class="icenia-service-link">Find Jobs ‚Üí</span>
                    </a>

                    <a href={BASE + "guide/"} class="icenia-service-card">
                        <div class="icenia-service-icon">üëã</div>
                        <h3 class="icenia-service-title">Join Us</h3>
                        <p class="icenia-service-desc">
                            Whether you're a builder, miner, PvPer, shopkeeper, or lawmaker ‚Äî 
                            Icenia has a role for you. Jobs, resources, and events await.
                        </p>
                        <span class="icenia-service-link">Get Started ‚Üí</span>
                    </a>
                </div>
            </section>

            <!-- Call to Action -->
            <section class="icenia-cta-section">
                <div class="icenia-cta-content">
                    <h2 class="govuk-heading-l">Ready to Join Us?</h2>
                    <p class="govuk-body-l">
                        Whether you're a new player looking for a home or an experienced player 
                        seeking new opportunities, Icenia has a place for you.
                    </p>
                    <div class="icenia-cta-actions">
                        <a href={BASE + "guide/"} class="icenia-btn">Read the Guide</a>
                        <a href="https://discord.gg/dfwSjCjRN5" target="_blank" class="icenia-btn icenia-btn-secondary">Join Our Discord</a>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <style>
        .home-services-section {
            padding: 2rem 0 3rem;
        }

    </style>
</DefaultLayout>
