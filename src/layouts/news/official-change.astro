---
import { type MarkdownLayoutProps } from "astro";
import { Strings } from "@helpers";
import { OfficialChanges } from "@collections";

import PostLayout from "@layouts/news/post.astro";

export type Props = MarkdownLayoutProps<OfficialChanges.OfficialChange>;
const { frontmatter } = Astro.props as Props;
const change = OfficialChanges.ensureOfficialChange(frontmatter);

// Get appropriate colors based on action type
function getActionColours(action: string): { background: string; text: string } {
    switch (action) {
        case "appointed":
        case "elected":
        case "reelected":
            return { background: "3A8017", text: "ffffff" };
        case "resigned":
            return { background: "ffc107", text: "000000" };
        case "removed":
            return { background: "dc3545", text: "ffffff" };
        case "succeeded":
            return { background: "17a2b8", text: "ffffff" };
        default:
            return { background: "6c757d", text: "ffffff" };
    }
}

// Get human-readable change type label
function getChangeTypeLabel(changetype: string): string {
    switch (changetype) {
        case "senate-election":
            return "Senate Election";
        case "senate-byelection":
            return "Senate By-Election";
        case "secretary-change":
            return "Secretary Change";
        case "speaker-vote":
            return "Speaker Vote";
        case "president-change":
            return "President Change";
        case "executive-change":
            return "Executive Change";
        default:
            return "Official Change";
    }
}

// Format role names from kebab-case to Title Case
function formatRoleName(role: string): string {
    return role
        .split('-')
        .map(word => word.charAt(0).toUpperCase() + word.slice(1))
        .join(' ');
}
---
<PostLayout chin={false}>
    <div class="govuk-panel govuk-panel--confirmation">
        <h1 class="govuk-panel__title">
            {change.headline}
        </h1>
        <div class="govuk-panel__body">
            {Strings.formatDate(change.date, "dS mmmm yyyy")}
        </div>
    </div>

    <div class="govuk-width-container">
        <div class="govuk-grid-row">

            <div class="govuk-grid-column-two-thirds">
                <slot><br/></slot>
            </div>

            <div class="govuk-grid-column-one-third">
                <style>
                    a.official-link {
                        text-decoration: none;
                    }
                    a.official-link:hover {
                        filter: brightness(85%);
                    }

                    div.official-change-card {
                        width: 100%;
                        text-align: center;
                        padding: 15px 0;
                        margin-bottom: 10px;
                    }
                    div.official-change-card:active {
                        border-bottom: 4px solid #000;
                        margin-bottom: 6px;
                    }

                    span.change-type-badge {
                        width: 100%;
                        text-align: center;
                        padding: 15px 0;
                        margin-bottom: 10px;
                        display: inline-block;
                        padding: 8px 16px;
                        background: #1C70B8;
                        color: #ffffff;
                        /* border-radius: 4px; */
                        font-size: 1.5rem;
                        font-weight: 700;
                        /* margin-bottom: 15px; */
                        letter-spacing: 0.3px;
                    }
                </style>

                <span class="change-type-badge">{getChangeTypeLabel(change.changetype)}</span>

                {change.officials.map((official) => {
                    const colours = getActionColours(official.action);
                    return (
                        <a class="govuk-link official-link" href="#">
                            <div class="official-change-card" style={`background: #${colours.background}; color: #${colours.text};`}>
                                <b>{formatRoleName(official.action)}</b>
                                <br/>
                                {official.name} as {formatRoleName(official.role)}
                                <br/>
                                {/* <span style="text-transform: uppercase; font-size: 1rem; font-weight: 700; letter-spacing: 0.5px;">{official.action}</span> */}
                            </div>
                        </a>
                    );
                })}
            </div>
        </div>
    </div>
</PostLayout>
