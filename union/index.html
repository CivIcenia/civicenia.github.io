<!DOCTYPE html><html lang="en"> <head><meta charset="utf-8"><title>The Union - Republic of Icenia</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="Explore the diverse states and territories that make up the Third Republic of Icenia."><meta name="keywords" content=""><link rel="canonical" href="https://civicenia.github.io/union/"><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/assets/css/sanitize-13.0.0.css"><link rel="stylesheet" href="/assets/css/govuk-frontend-4.3.1.min.css"><link rel="stylesheet" href="/assets/css/icenia-theme.css"><script src="/assets/js/govuk-frontend-4.3.1.min.js"></script><link rel="stylesheet" href="/astro/index.hhcQdv6R.css"><script type="module" src="/astro/hoisted.DUnvKJkA.js"></script></head> <body data-base="/" data-header-height-desktop="56" data-header-height-mobile="44"> <a class="govuk-skip-link" href="#main-content">Skip to main content</a> <script>document.body.className = ((document.body.className) ? document.body.className + " js-enabled" : "js-enabled");</script> <!-- Custom Header bar with logo --> <header class="icenia-header" role="banner"> <div class="icenia-header__container"> <div class="icenia-header__logo"> <a href="/" class="icenia-header__link"> <img src="/assets/images/icenia_logo.svg" class="icenia-header__logo-img" alt=""> <span>Icenia</span> </a> </div> <button class="icenia-menu-toggle" id="menuToggle" aria-label="Open menu" aria-expanded="false"> <span class="icenia-menu-toggle__icon"> <span></span> <span></span> <span></span> </span> </button> </div> </header> <!-- Slide-out menu (for mobile/narrow screens) --> <div class="icenia-menu-overlay" id="menuOverlay"></div> <nav class="icenia-slide-menu" id="slideMenu" aria-label="Mobile navigation"> <div class="icenia-slide-menu__header"> <span class="icenia-slide-menu__title">Menu</span> <button class="icenia-slide-menu__close" id="menuClose" aria-label="Close menu">&times;</button> </div> <ul class="icenia-slide-menu__nav"> <li class="icenia-slide-menu__item"> <span class="icenia-slide-menu__link has-children" data-toggle="submenu"> Government </span> <ul class="icenia-slide-menu__submenu"> <div class="icenia-slide-menu__submenu-inner"> <li> <a href="/" target="_self"> Home </a> </li><li> <a href="/government/officials/" target="_self"> Officials </a> </li><li> <a href="/news/" target="_self"> News </a> </li><li> <a href="/laws/" target="_self"> Legislation </a> </li> </div> </ul> </li><li class="icenia-slide-menu__item"> <span class="icenia-slide-menu__link has-children" data-toggle="submenu"> Explore Icenia </span> <ul class="icenia-slide-menu__submenu"> <div class="icenia-slide-menu__submenu-inner"> <li> <a href="/union/" target="_self"> The Republic </a> </li><li> <a href="https://map.civinfo.net/#url=https://civicenia.github.io/government/borders.json" target="_blank"> CivMap </a> </li> </div> </ul> </li><li class="icenia-slide-menu__item"> <span class="icenia-slide-menu__link has-children" data-toggle="submenu"> Icenia City </span> <ul class="icenia-slide-menu__submenu"> <div class="icenia-slide-menu__submenu-inner"> <li> <a href="/icenia-city/" target="_self"> Home </a> </li><li> <a href="/icenia-city/council/" target="_self"> City Council </a> </li><li> <a href="/icenia-city/news/" target="_self"> City News </a> </li><li> <a href="/icenia-city/laws/" target="_self"> City Laws </a> </li><li> <a href="/icenia-city/shops/" target="_self"> Shops </a> </li> </div> </ul> </li><li class="icenia-slide-menu__item"> <span class="icenia-slide-menu__link has-children" data-toggle="submenu"> Join Us </span> <ul class="icenia-slide-menu__submenu"> <div class="icenia-slide-menu__submenu-inner"> <li> <a href="/guide/" target="_self"> New Player Guide </a> </li><li> <a href="https://discord.gg/dfwSjCjRN5" target="_blank"> Discord </a> </li> </div> </ul> </li><li class="icenia-slide-menu__item"> <span class="icenia-slide-menu__link has-children" data-toggle="submenu"> Utilities </span> <ul class="icenia-slide-menu__submenu"> <div class="icenia-slide-menu__submenu-inner"> <li> <a href="/shops/" target="_self"> Shop Explorer </a> </li><li> <a href="/stv/" target="_self"> Icenian STV </a> </li><li> <a href="/stv/visualize/" target="_self"> STV Visualization </a> </li><li> <a href="/admin/index.html" target="_self"> Admin Panel </a> </li> </div> </ul> </li> </ul> </nav> <!-- Separate Navigation Bar (for desktop/wide screens) --> <nav class="icenia-navbar" aria-label="Main navigation"> <div class="icenia-navbar__container govuk-width-container"> <ul class="icenia-navbar__list" id="navigation"> <li class="icenia-navbar__item"> <span class="icenia-navbar__link has-dropdown"> Government </span> <ul class="icenia-navbar__dropdown"> <li> <a href="/" target="_self"> Home </a> </li><li> <a href="/government/officials/" target="_self"> Officials </a> </li><li> <a href="/news/" target="_self"> News </a> </li><li> <a href="/laws/" target="_self"> Legislation </a> </li> </ul> </li><li class="icenia-navbar__item"> <span class="icenia-navbar__link has-dropdown"> Explore Icenia </span> <ul class="icenia-navbar__dropdown"> <li> <a href="/union/" target="_self"> The Republic </a> </li><li> <a href="https://map.civinfo.net/#url=https://civicenia.github.io/government/borders.json" target="_blank"> CivMap </a> </li> </ul> </li><li class="icenia-navbar__item"> <span class="icenia-navbar__link has-dropdown"> Icenia City </span> <ul class="icenia-navbar__dropdown"> <li> <a href="/icenia-city/" target="_self"> Home </a> </li><li> <a href="/icenia-city/council/" target="_self"> City Council </a> </li><li> <a href="/icenia-city/news/" target="_self"> City News </a> </li><li> <a href="/icenia-city/laws/" target="_self"> City Laws </a> </li><li> <a href="/icenia-city/shops/" target="_self"> Shops </a> </li> </ul> </li><li class="icenia-navbar__item"> <span class="icenia-navbar__link has-dropdown"> Join Us </span> <ul class="icenia-navbar__dropdown"> <li> <a href="/guide/" target="_self"> New Player Guide </a> </li><li> <a href="https://discord.gg/dfwSjCjRN5" target="_blank"> Discord </a> </li> </ul> </li><li class="icenia-navbar__item"> <span class="icenia-navbar__link has-dropdown"> Utilities </span> <ul class="icenia-navbar__dropdown"> <li> <a href="/shops/" target="_self"> Shop Explorer </a> </li><li> <a href="/stv/" target="_self"> Icenian STV </a> </li><li> <a href="/stv/visualize/" target="_self"> STV Visualization </a> </li><li> <a href="/admin/index.html" target="_self"> Admin Panel </a> </li> </ul> </li> </ul> </div> </nav>  <div class="govuk-width-container"> <style>main.govuk-main-wrapper { padding-top: 0 !important; }</style> <main class="govuk-main-wrapper govuk-body" id="main-content" role="main"> <div class="page-header" data-astro-cid-xd5vahtb><h1 class="govuk-heading-xl" style="margin-bottom: 10px;" data-astro-cid-xd5vahtb>The Union</h1><p class="govuk-body-l" data-astro-cid-xd5vahtb>Explore the diverse states and territories of the Third Republic of Icenia.</p></div><div class="union-info" data-astro-cid-xd5vahtb><h2 class="govuk-heading-m" style="margin-top: 0;" data-astro-cid-xd5vahtb>About the Republic</h2><p class="govuk-body" style="margin-bottom: 0;" data-astro-cid-xd5vahtb>
The Republic of Icenia is a federal union comprised of states and territories across CivMC. 
            Each state maintains its own local governance while participating in the broader Republic 
            through representation in the Senate and adherence to the Constitution.
</p></div><div class="map-card" data-astro-cid-xd5vahtb><h3 class="govuk-heading-m" style="margin-top: 0; color: #1C70B8;" data-astro-cid-xd5vahtb>Interactive Territory Map</h3><p class="govuk-body" data-astro-cid-xd5vahtb>
Explore Icenian territories on the CivMC map. Scroll to zoom, drag to pan, and click territories for details.
</p><div class="leaflet-map-container" data-astro-cid-swuwfv6j> <div id="icenia-map" class="leaflet-map" data-astro-cid-swuwfv6j></div> <!-- Legend with integrated info panel --> <div class="map-legend" id="map-legend" data-astro-cid-swuwfv6j> <div class="legend-section" data-astro-cid-swuwfv6j> <h4 data-astro-cid-swuwfv6j>Territories</h4> <div class="scroll-container" data-astro-cid-swuwfv6j> <div class="legend-items" id="legend-items" data-astro-cid-swuwfv6j> <div class="legend-item" data-id="7f4c28bc-d266-4031-b1bc-d2fa6087f586" data-astro-cid-swuwfv6j> <span class="legend-color" style="background-color: #00C9FF;" data-astro-cid-swuwfv6j></span> <span class="legend-name" data-astro-cid-swuwfv6j>Icenia Federal Territory</span> </div><div class="legend-item" data-id="23418165-54bb-43d0-b19e-b665b297d8e7" data-astro-cid-swuwfv6j> <span class="legend-color" style="background-color: #1C70B8;" data-astro-cid-swuwfv6j></span> <span class="legend-name" data-astro-cid-swuwfv6j>Icenia City</span> </div><div class="legend-item" data-id="6e2b9b7c-710c-4771-bfcb-38ccc23ec860" data-astro-cid-swuwfv6j> <span class="legend-color" style="background-color: #013201;" data-astro-cid-swuwfv6j></span> <span class="legend-name" data-astro-cid-swuwfv6j>Southshire</span> </div><div class="legend-item" data-id="a32a8625-fea7-4461-a38d-2b8371e4ddd6" data-astro-cid-swuwfv6j> <span class="legend-color" style="background-color: #B22234;" data-astro-cid-swuwfv6j></span> <span class="legend-name" data-astro-cid-swuwfv6j>Icarus</span> </div><div class="legend-item" data-id="9406988d-caac-492d-bfe2-0639a85c3d36" data-astro-cid-swuwfv6j> <span class="legend-color" style="background-color: #2F9AFF;" data-astro-cid-swuwfv6j></span> <span class="legend-name" data-astro-cid-swuwfv6j>Cortesia Del Mar</span> </div><div class="legend-item" data-id="878b53b7-0148-40cb-8649-7bf646800282" data-astro-cid-swuwfv6j> <span class="legend-color" style="background-color: #FFFF55;" data-astro-cid-swuwfv6j></span> <span class="legend-name" data-astro-cid-swuwfv6j>Riemark</span> </div> </div> <div class="scroll-indicator" id="scroll-indicator" data-astro-cid-swuwfv6j> <div class="scroll-track" data-astro-cid-swuwfv6j> <div class="scroll-thumb" data-astro-cid-swuwfv6j></div> </div> </div> </div> </div> <div class="legend-info-section" data-astro-cid-swuwfv6j> <div class="scroll-container scroll-container-info" data-astro-cid-swuwfv6j> <div class="legend-info-content" id="info-panel-content" data-astro-cid-swuwfv6j> <div class="info-placeholder" data-astro-cid-swuwfv6j>Hover over a territory to see details</div> </div> <div class="scroll-indicator" id="scroll-indicator-info" data-astro-cid-swuwfv6j> <div class="scroll-track" data-astro-cid-swuwfv6j> <div class="scroll-thumb" data-astro-cid-swuwfv6j></div> </div> </div> </div> </div> </div> <!-- Controls info --> <div class="map-controls-info" data-astro-cid-swuwfv6j> <span data-astro-cid-swuwfv6j>üñ±Ô∏è Scroll to zoom ‚Ä¢ Drag to pan</span> </div> </div> <!-- Leaflet CSS --> <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="">  <!-- Leaflet JS -->  <script>(function(){const territoriesJson = "[{\"name\":\"Icenia Federal Territory\",\"id\":\"7f4c28bc-d266-4031-b1bc-d2fa6087f586\",\"color\":\"#00C9FF\",\"notes\":\"The heartlands of Icenia, founded May 15th 2022\",\"subregions\":[{\"name\":\"Icenia\",\"polygon\":[[[-4804,-2802],[-4683,-2802],[-4705,-2824],[-4750,-2837],[-4734,-2876],[-4737,-2912],[-4720,-2943],[-4719,-2973],[-4707,-2990],[-4690,-2998],[-4690,-3020],[-4673,-3047],[-4632,-3091],[-4581,-3114],[-4563,-3139],[-4554,-3173],[-4528,-3189],[-4507,-3175],[-4481,-3168],[-4489,-3130],[-4464,-3113],[-4463,-3065],[-4438,-3047],[-4399,-3061],[-4381,-3060],[-4348,-3068],[-4313,-3053],[-4271,-3096],[-4245,-3113],[-3759,-3112],[-3738,-3114],[-3730,-3129],[-3723,-3149],[-3680,-3170],[-3699,-3192],[-3695,-3214],[-3690,-3229],[-3711,-3235],[-3729,-3271],[-3730,-3284],[-3738,-3293],[-3729,-3299],[-3739,-3340],[-3760,-3340],[-3760,-3370],[-3785,-3390],[-3790,-3430],[-3769,-3444],[-3756,-3464],[-3743,-3465],[-3716,-3432],[-3693,-3441],[-3674,-3457],[-3661,-3441],[-3647,-3441],[-3636,-3449],[-3615,-3449],[-3603,-3442],[-3560,-3442],[-3542,-3433],[-3517,-3456],[-3482,-3432],[-3400,-3458],[-2587,-3458],[-2605,-3762],[-2838,-4042],[-2700,-4530],[-2440,-4610],[-2292,-4914],[-2150,-5120],[-1777,-5481],[-1890,-5595],[-2001,-5679],[-2024,-5828],[-2034,-5984],[-2228,-6180],[-2364,-6416],[-2396,-6468],[-2158,-6882],[-2163,-6908],[-2134,-6938],[-1982,-7239],[-1998,-7271],[-1987,-7344],[-1997,-7377],[-1991,-7407],[-1983,-7407],[-1946,-7416],[-1914,-7408],[-1885,-7428],[-1861,-7425],[-1833,-7450],[-1826,-7475],[-1843,-7568],[-1838,-7643],[-1879,-7696],[-1905,-7712],[-2288,-7712],[-2704,-7712],[-2696,-7664],[-2674,-7642],[-2670,-7603],[-2635,-7589],[-2625,-7576],[-2637,-7553],[-2688,-7519],[-2695,-7441],[-2846,-7158],[-3187,-7228],[-3704,-7151],[-4265,-7294],[-3968,-6941],[-3928,-6482],[-3718,-6266],[-3671,-6259],[-3673,-5866],[-3601,-5774],[-3556,-5764],[-3532,-5743],[-3526,-5687],[-3538,-5634],[-3489,-5572],[-3464,-5558],[-3410,-5570],[-3402,-5528],[-3433,-5516],[-3452,-5477],[-3506,-5438],[-3565,-5376],[-3605,-5390],[-3653,-5386],[-3676,-5361],[-3718,-5346],[-3749,-5311],[-3777,-5326],[-3876,-5302],[-3926,-5341],[-3974,-5331],[-4014,-5308],[-4022,-5277],[-4058,-5268],[-4074,-5303],[-4089,-5313],[-4098,-5336],[-4154,-5336],[-4182,-5352],[-4211,-5344],[-4284,-5334],[-4451,-5333],[-4476,-5361],[-4510,-5361],[-4653,-5430],[-4679,-5438],[-4711,-5457],[-4753,-5472],[-4754,-5690],[-4776,-5676],[-4851,-5714],[-4898,-5693],[-5033,-5702],[-5060,-5810],[-5136,-5816],[-5144,-5765],[-5153,-5742],[-5166,-5732],[-5186,-5698],[-5198,-5666],[-5229,-5663],[-5240,-5655],[-5250,-5648],[-5271,-5625],[-5290,-5608],[-5312,-5596],[-5321,-5582],[-5316,-5563],[-5313,-5542],[-5312,-5525],[-5322,-5506],[-5330,-5492],[-5338,-5473],[-5360,-5395],[-5272,-5279],[-5376,-5152],[-5391,-5090],[-5812,-5152],[-6057,-4955],[-6277,-4957],[-6279,-4919],[-6310,-4910],[-6345,-4933],[-6385,-4903],[-6458,-4960],[-6477,-4928],[-6485,-4908],[-6513,-4890],[-6479,-4873],[-6476,-4841],[-6540,-4766],[-6524,-4750],[-6523,-4713],[-6570,-4667],[-6602,-4648],[-6612,-4631],[-6595,-4610],[-6563,-4621],[-6541,-4611],[-6549,-4593],[-6545,-4567],[-6524,-4564],[-6526,-4535],[-6486,-4515],[-6469,-4536],[-6469,-4555],[-6432,-4548],[-6404,-4435],[-6421,-4415],[-6403,-4380],[-6456,-4343],[-6453,-4319],[-6489,-4283],[-6475,-4261],[-6485,-4252],[-6504,-4263],[-6539,-4270],[-6538,-4235],[-6512,-4223],[-6480,-4222],[-6450,-4209],[-6450,-4189],[-6461,-4171],[-6452,-4145],[-6423,-4147],[-6388,-4172],[-6363,-4204],[-6297,-4175],[-6289,-4217],[-6273,-4239],[-6269,-4264],[-6255,-4278],[-6241,-4282],[-6247,-4322],[-6237,-4342],[-6218,-4363],[-6194,-4378],[-6153,-4377],[-6145,-4368],[-6126,-4366],[-6108,-4350],[-6112,-4330],[-6080,-4316],[-6076,-4299],[-6064,-4288],[-6059,-4270],[-6070,-4237],[-6067,-4215],[-6059,-4198],[-6087,-4160],[-6210,-4111],[-6205,-4083],[-6226,-4063],[-6219,-4042],[-6175,-4041],[-6151,-4061],[-6107,-4068],[-6083,-4050],[-6013,-4039],[-5978,-4005],[-5978,-3984],[-6010,-3965],[-6013,-3937],[-6047,-3887],[-6082,-3919],[-6113,-3891],[-6112,-3845],[-6083,-3814],[-6064,-3837],[-6036,-3836],[-6029,-3797],[-5989,-3776],[-5989,-3754],[-6002,-3742],[-6001,-3720],[-5978,-3702],[-5959,-3674],[-5917,-3668],[-5892,-3682],[-5897,-3710],[-5889,-3725],[-5872,-3740],[-5856,-3776],[-5819,-3771],[-5787,-3795],[-5768,-3822],[-5735,-3846],[-5703,-3837],[-5696,-3793],[-5667,-3794],[-5631,-3780],[-5591,-3793],[-5561,-3745],[-5569,-3711],[-5556,-3682],[-5552,-3649],[-5523,-3572],[-5510,-3555],[-5482,-3526],[-5458,-3477],[-5462,-3408],[-5442,-3326],[-5471,-3297],[-5406,-3292],[-5390,-3255],[-5348,-3211],[-5228,-3212],[-5185,-3212],[-5139,-3181],[-5120,-3165],[-5077,-3143],[-5049,-3091],[-5066,-3086],[-5068,-3070],[-5088,-3062],[-5090,-3039],[-5132,-3023],[-5155,-2999],[-5154,-2959],[-5129,-2931],[-5132,-2922],[-5004,-2922],[-5004,-2724],[-4804,-2724]],[[-3369,-4905],[-3395,-4947],[-3362,-4973],[-3315,-4979],[-3347,-5100],[-3374,-5146],[-3392,-5206],[-3348,-5251],[-3297,-5239],[-3254,-5265],[-3223,-5282],[-3193,-5321],[-3157,-5363],[-3114,-5400],[-3102,-5465],[-3045,-5467],[-2976,-5432],[-2909,-5264],[-2829,-5237],[-2731,-5227],[-2654,-5196],[-2563,-5194],[-2448,-5131],[-2370,-4998],[-2456,-4834],[-2579,-4706],[-2803,-4703],[-2890,-4721],[-2929,-4729],[-2980,-4748],[-3025,-4787],[-3114,-4778],[-3121,-4827],[-3189,-4885],[-3281,-4901],[-3334,-4900]],[[-6100,-4661],[-6083,-4627],[-6082,-4608],[-6098,-4595],[-6118,-4594],[-6120,-4614],[-6145,-4635],[-6156,-4627],[-6165,-4633],[-6182,-4624],[-6195,-4595],[-6211,-4586],[-6224,-4607],[-6224,-4624],[-6260,-4627],[-6274,-4619],[-6288,-4629],[-6288,-4677],[-6303,-4691],[-6320,-4699],[-6322,-4716],[-6351,-4734],[-6314,-4803],[-6118,-4726],[-6085,-4688]],[[-5788,-4229],[-5789,-4282],[-5771,-4285],[-5760,-4329],[-5761,-4391],[-5816,-4403],[-5913,-4405],[-5911,-4239],[-5859,-4229]],[[-3562,-4494],[-3552,-4614],[-3576,-4676],[-3596,-4722],[-3707,-4812],[-3749,-4863],[-3809,-4778],[-3848,-4817],[-3866,-4868],[-4081,-4859],[-4268,-4756],[-4424,-4542],[-4302,-4196],[-4004,-4014],[-3764,-4038],[-3360,-4348]],[[-5423,-4703],[-5382,-4708],[-5344,-4731],[-5311,-4774],[-5344,-4804],[-5374,-4785],[-5429,-4823],[-5475,-4829],[-5474,-4858],[-5479,-4915],[-5515,-4976],[-5536,-5011],[-5556,-5019],[-5578,-5006],[-5565,-4946],[-5570,-4917],[-5552,-4897],[-5575,-4885],[-5593,-4842],[-5563,-4811],[-5514,-4807],[-5490,-4811],[-5490,-4789],[-5494,-4770],[-5462,-4729]]]},{\"name\":\"Butternut\",\"polygon\":[[-3225,-2403],[-3225,-2371],[-3165,-2338],[-3150,-2361],[-3135,-2375],[-3089,-2360],[-3089,-2245],[-2957,-2245],[-2936,-2218],[-2926,-2198],[-2918,-2163],[-2847,-2166],[-2789,-2239],[-2762,-2248],[-2749,-2264],[-2689,-2304],[-2627,-2280],[-2586,-2269],[-2537,-2289],[-2514,-2337],[-2515,-2357],[-2515,-2374],[-2496,-2384],[-2473,-2383],[-2417,-2476],[-2404,-2476],[-2371,-2511],[-2378,-2544],[-2407,-2578],[-2434,-2615],[-2467,-2618],[-2507,-2617],[-2562,-2673],[-2604,-2673],[-2638,-2661],[-2659,-2655],[-2679,-2656],[-2688,-2687],[-2713,-2703],[-2743,-2708],[-2777,-2730],[-2843,-2730],[-2870,-2753],[-2879,-2785],[-2931,-2760],[-3024,-2753],[-3046,-2724],[-3088,-2695],[-3122,-2625],[-3170,-2630],[-3208,-2609],[-3214,-2586],[-3222,-2562],[-3200,-2500],[-3194,-2449]]},{\"name\":\"Sneedland\",\"polygon\":[[-8006,-5888],[-8181,-5962],[-7914,-6350],[-7440,-6899],[-7031,-7299],[-6994,-7275],[-6957,-7261],[-6933,-7221],[-6896,-7189],[-6862,-7175],[-6827,-7141],[-6796,-7123],[-6758,-7092],[-6720,-7077],[-6700,-7062],[-6691,-7038],[-6703,-7001],[-6671,-6976],[-6646,-6955],[-6593,-6888],[-6573,-6844],[-6541,-6816],[-6523,-6776],[-6593,-6701],[-6620,-6706],[-6678,-6648],[-6680,-6633],[-6669,-6626],[-6665,-6613],[-6669,-6590],[-6671,-6568],[-6678,-6555],[-6759,-6554],[-6759,-6317],[-6942,-6315],[-6985,-6315],[-7001,-6291],[-6945,-6232],[-6885,-6181],[-6861,-6213],[-6842,-6218],[-6812,-6239],[-6751,-6121],[-6632,-6029],[-6608,-5960],[-6665,-5916],[-6649,-5887],[-6687,-5853],[-6751,-5845],[-6796,-5867],[-6836,-5918],[-6853,-5954],[-6908,-5997],[-6936,-6015],[-6963,-6009],[-6993,-5982],[-6972,-5945],[-7055,-5860],[-7082,-5816],[-7149,-5814],[-7159,-5787],[-7113,-5756],[-7093,-5725],[-7111,-5688],[-7092,-5658],[-7108,-5633],[-7153,-5609],[-7191,-5603],[-7211,-5621],[-7209,-5658],[-7274,-5729],[-7323,-5734],[-7413,-5930],[-7522,-5900],[-7523,-5859],[-7560,-5832],[-7553,-5723],[-7615,-5679],[-7679,-5667],[-7658,-5615],[-7703,-5578],[-7810,-5640],[-7724,-5791],[-7809,-5826],[-7821,-5887],[-7848,-5907],[-7888,-5876],[-7926,-5889],[-7978,-5857]]}]},{\"name\":\"Icenia City\",\"id\":\"23418165-54bb-43d0-b19e-b665b297d8e7\",\"color\":\"#1C70B8\",\"notes\":\"Formed from federal territory on 19th November 2025\",\"subregions\":[{\"name\":\"Icenia City\",\"polygon\":[[-3562,-4494],[-3552,-4614],[-3576,-4676],[-3596,-4722],[-3707,-4812],[-3749,-4863],[-3809,-4778],[-3848,-4817],[-3866,-4868],[-4081,-4859],[-4268,-4756],[-4424,-4542],[-4302,-4196],[-4004,-4014],[-3764,-4038],[-3360,-4348]]}]},{\"name\":\"Southshire\",\"id\":\"6e2b9b7c-710c-4771-bfcb-38ccc23ec860\",\"color\":\"#013201\",\"notes\":\"Southshire became a State of Icenia on 30th April 2023.\",\"subregions\":[{\"name\":\"Southshire\",\"polygon\":[[-7363,-4210],[-7336,-4230],[-7333,-4280],[-7314,-4357],[-7338,-4407],[-7361,-4474],[-7370,-4522],[-7387,-4566],[-7374,-4590],[-7387,-4776],[-7333,-4817],[-7339,-4860],[-7316,-4885],[-7288,-4872],[-7272,-4892],[-7305,-4914],[-7299,-4948],[-7329,-4976],[-7307,-5033],[-7277,-5087],[-7252,-5104],[-7214,-5181],[-6993,-5433],[-6736,-5433],[-6722,-5493],[-6700,-5517],[-6669,-5504],[-6666,-5454],[-6647,-5437],[-6650,-5379],[-6607,-5351],[-6574,-5362],[-6553,-5350],[-6520,-5310],[-6486,-5290],[-6437,-5286],[-6463,-5235],[-6441,-5204],[-6473,-5071],[-6457,-5026],[-6473,-4974],[-6458,-4960],[-6477,-4928],[-6485,-4908],[-6513,-4890],[-6479,-4873],[-6476,-4841],[-6540,-4766],[-6524,-4750],[-6523,-4713],[-6570,-4667],[-6602,-4648],[-6612,-4631],[-6595,-4610],[-6563,-4621],[-6541,-4611],[-6549,-4593],[-6545,-4567],[-6524,-4564],[-6526,-4535],[-6486,-4515],[-6469,-4536],[-6469,-4555],[-6432,-4548],[-6404,-4435],[-6421,-4415],[-6403,-4380],[-6456,-4343],[-6453,-4319],[-6489,-4283],[-6475,-4261],[-6485,-4252],[-6504,-4263],[-6539,-4270],[-6538,-4235],[-6512,-4223],[-6480,-4222],[-6450,-4209],[-6450,-4189],[-6461,-4171],[-6452,-4145],[-6504,-4100],[-6630,-4086],[-6647,-4056],[-6681,-4033],[-6703,-4042],[-6713,-4062],[-6697,-4104],[-6714,-4144],[-6814,-4211],[-6857,-4208],[-6891,-4260],[-6891,-4290],[-6918,-4317],[-6824,-4389],[-6850,-4418],[-6917,-4448],[-6948,-4445],[-6969,-4400],[-6995,-4390],[-7009,-4359],[-7033,-4335],[-7034,-4306],[-7068,-4304],[-7112,-4223],[-7201,-4169],[-7255,-4195],[-7334,-4164]]},{\"name\":\"Batavian Plains\",\"polygon\":[[-6100,-4661],[-6083,-4627],[-6082,-4608],[-6098,-4595],[-6118,-4594],[-6120,-4614],[-6145,-4635],[-6156,-4627],[-6165,-4633],[-6182,-4624],[-6195,-4595],[-6211,-4586],[-6224,-4607],[-6224,-4624],[-6260,-4627],[-6274,-4619],[-6288,-4629],[-6288,-4677],[-6303,-4691],[-6320,-4699],[-6322,-4716],[-6351,-4734],[-6314,-4803],[-6118,-4726],[-6085,-4688]]},{\"name\":\"Castle Batavia\",\"polygon\":[[-5788,-4229],[-5789,-4282],[-5771,-4285],[-5760,-4329],[-5761,-4391],[-5816,-4403],[-5913,-4405],[-5911,-4239],[-5859,-4229]]},{\"name\":\"Batavian Monastary\",\"polygon\":[[-6210,-4111],[-6243,-4136],[-6256,-4157],[-6297,-4175],[-6289,-4217],[-6273,-4239],[-6269,-4264],[-6255,-4278],[-6241,-4282],[-6247,-4322],[-6237,-4342],[-6218,-4363],[-6194,-4378],[-6153,-4377],[-6145,-4368],[-6126,-4366],[-6108,-4350],[-6112,-4330],[-6080,-4316],[-6076,-4299],[-6064,-4288],[-6059,-4270],[-6070,-4237],[-6067,-4215],[-6059,-4198],[-6072,-4181],[-6087,-4160]]}]},{\"name\":\"Icarus\",\"id\":\"a32a8625-fea7-4461-a38d-2b8371e4ddd6\",\"color\":\"#B22234\",\"notes\":\"Icarus became a State of Icenia on the 28th August, 2024 via the Icarus-Icenia Merger.\",\"subregions\":[{\"name\":\"Icarus\",\"polygon\":[[-9404,-2997],[-9404,-2997],[-9380,-3012],[-9370,-3011],[-9351,-3028],[-9349,-3047],[-9328,-3065],[-9305,-3067],[-9289,-3087],[-9266,-3083],[-9253,-3095],[-9236,-3078],[-9156,-3075],[-9129,-3096],[-9106,-3122],[-9107,-3136],[-9118,-3147],[-9130,-3166],[-9119,-3186],[-9103,-3188],[-9080,-3180],[-9066,-3177],[-9059,-3180],[-9045,-3199],[-9045,-3235],[-9042,-3240],[-9033,-3248],[-9032,-3263],[-9043,-3269],[-9055,-3274],[-9058,-3286],[-9059,-3307],[-9044,-3308],[-9049,-3310],[-9050,-3320],[-9055,-3324],[-9059,-3336],[-9050,-3344],[-9042,-3357],[-9036,-3359],[-9031,-3365],[-9033,-3370],[-9026,-3382],[-9020,-3390],[-9021,-3402],[-8865,-3404],[-8845,-3392],[-8827,-3383],[-8751,-3417],[-8715,-3449],[-8696,-3440],[-8712,-3394],[-8716,-3360],[-8697,-3339],[-8672,-3328],[-8640,-3349],[-8626,-3346],[-8604,-3316],[-8575,-3327],[-8546,-3327],[-8527,-3357],[-8467,-3379],[-8433,-3403],[-8401,-3367],[-8394,-3329],[-8418,-3290],[-8423,-3255],[-8396,-3245],[-8382,-3228],[-8392,-3193],[-8389,-3166],[-8346,-3129],[-8346,-3129],[-8336,-3114],[-8310,-3116],[-8285,-3129],[-8248,-3117],[-8267,-3065],[-8241,-3044],[-8233,-3010],[-8209,-2999],[-8180,-3017],[-8168,-3035],[-8203,-3062],[-8176,-3113],[-8135,-3135],[-8116,-3153],[-8111,-3171],[-8126,-3186],[-8121,-3195],[-8110,-3209],[-8081,-3214],[-8059,-3173],[-8039,-3165],[-8051,-3151],[-7977,-3087],[-7932,-3093],[-7917,-3078],[-7886,-3065],[-7854,-3068],[-7828,-3047],[-7818,-3053],[-7803,-3053],[-7793,-3050],[-7784,-3037],[-7785,-3020],[-7762,-3002],[-7720,-3012],[-7679,-3051],[-7633,-3112],[-7584,-3126],[-7539,-3169],[-7530,-3215],[-7498,-3228],[-7453,-3268],[-7426,-3303],[-7384,-3338],[-7370,-3327],[-7350,-3297],[-7286,-3282],[-7262,-3286],[-7218,-3248],[-7208,-3226],[-7248,-3194],[-7228,-3156],[-7150,-3138],[-7092,-3182],[-7056,-3168],[-7026,-3126],[-7046,-3094],[-6932,-3012],[-6900,-2940],[-6802,-2926],[-6766,-2916],[-6742,-2876],[-6732,-2820],[-6702,-2744],[-6662,-2728],[-6582,-2750],[-6498,-2708],[-6528,-2652],[-6455,-2599],[-6508,-2443],[-6555,-2372],[-6556,-2308],[-6529,-2285],[-6548,-2229],[-6583,-2236],[-6719,-2161],[-6735,-2125],[-6713,-2087],[-6743,-2033],[-6790,-2028],[-6804,-1984],[-6843,-1998],[-6891,-1959],[-6936,-1985],[-6971,-2032],[-7026,-2011],[-7082,-1920],[-7129,-1764],[-7379,-1673],[-7710,-1718],[-8022,-2436],[-8171,-2462],[-8177,-2473],[-8194,-2474],[-8226,-2485],[-8236,-2504],[-8249,-2518],[-8242,-2523],[-8240,-2526],[-8246,-2531],[-8252,-2549],[-8273,-2561],[-8300,-2569],[-8312,-2568],[-8312,-2562],[-8315,-2558],[-8326,-2554],[-8328,-2548],[-8335,-2540],[-8345,-2536],[-8344,-2528],[-8347,-2523],[-8343,-2518],[-8345,-2505],[-8356,-2498],[-8362,-2506],[-8364,-2504],[-8364,-2501],[-8366,-2500],[-8371,-2500],[-8370,-2498],[-8366,-2496],[-8362,-2485],[-8370,-2475],[-8382,-2469],[-8399,-2471],[-8402,-2477],[-8403,-2479],[-8410,-2484],[-8421,-2483],[-8423,-2479],[-8424,-2470],[-8425,-2466],[-8429,-2463],[-8436,-2465],[-8448,-2454],[-8460,-2443],[-8468,-2443],[-8477,-2446],[-8486,-2456],[-8492,-2467],[-8509,-2481],[-8528,-2495],[-8530,-2511],[-8540,-2520],[-8547,-2517],[-8556,-2522],[-8580,-2521],[-8584,-2528],[-8587,-2535],[-8610,-2546],[-8615,-2541],[-8620,-2541],[-8627,-2525],[-8634,-2513],[-8635,-2507],[-8640,-2503],[-8644,-2505],[-8651,-2505],[-8659,-2502],[-8662,-2495],[-8666,-2489],[-8671,-2481],[-8685,-2479],[-8685,-2483],[-8689,-2492],[-8696,-2497],[-8702,-2499],[-8708,-2507],[-8711,-2518],[-8716,-2518],[-8717,-2531],[-8711,-2541],[-8710,-2545],[-8715,-2545],[-8716,-2547],[-8719,-2547],[-8721,-2551],[-8722,-2571],[-8723,-2575],[-8729,-2578],[-8740,-2572],[-8745,-2563],[-8746,-2527],[-8748,-2524],[-8762,-2517],[-8777,-2495],[-8785,-2480],[-8789,-2477],[-8805,-2477],[-8809,-2484],[-8817,-2495],[-8818,-2508],[-8822,-2513],[-8829,-2513],[-8836,-2507],[-8843,-2495],[-8846,-2487],[-8853,-2482],[-8863,-2479],[-8875,-2482],[-8882,-2490],[-8885,-2489],[-8887,-2485],[-8892,-2485],[-8897,-2494],[-8890,-2499],[-8889,-2504],[-8890,-2508],[-8897,-2509],[-8900,-2520],[-8914,-2516],[-8938,-2508],[-8942,-2499],[-8941,-2494],[-8939,-2485],[-8937,-2482],[-8937,-2472],[-8929,-2463],[-8929,-2455],[-8923,-2446],[-8916,-2440],[-8905,-2443],[-8893,-2438],[-8887,-2419],[-8879,-2414],[-8851,-2412],[-8821,-2398],[-8809,-2396],[-8801,-2387],[-8801,-2376],[-8807,-2368],[-8794,-2361],[-8777,-2351],[-8768,-2360],[-8755,-2351],[-8748,-2335],[-8755,-2334],[-8777,-2322],[-8783,-2314],[-8785,-2307],[-8790,-2301],[-8798,-2296],[-8806,-2291],[-8814,-2290],[-8820,-2287],[-8828,-2279],[-8831,-2277],[-8848,-2277],[-8852,-2274],[-8858,-2272],[-8860,-2267],[-8856,-2261],[-8849,-2257],[-8840,-2253],[-8829,-2252],[-8813,-2242],[-8810,-2243],[-8806,-2239],[-8802,-2239],[-8798,-2235],[-8801,-2229],[-8801,-2222],[-8793,-2216],[-8781,-2212],[-8774,-2212],[-8767,-2215],[-8758,-2215],[-8752,-2210],[-8750,-2207],[-8751,-2202],[-8753,-2199],[-8766,-2192],[-8773,-2192],[-8781,-2197],[-8789,-2197],[-8797,-2193],[-8802,-2190],[-8811,-2190],[-8817,-2184],[-8823,-2178],[-8825,-2173],[-8828,-2170],[-8833,-2166],[-8835,-2162],[-8840,-2158],[-8846,-2147],[-8845,-2133],[-8838,-2126],[-8825,-2120],[-8822,-2114],[-8816,-2110],[-8816,-2107],[-8833,-2098],[-8838,-2092],[-8836,-2063],[-8833,-2055],[-8821,-2050],[-8815,-2044],[-8826,-2038],[-8834,-2038],[-8839,-2036],[-8843,-2032],[-8846,-2024],[-8855,-2020],[-8859,-2015],[-8862,-2002],[-8821,-1955],[-8828,-1945],[-8832,-1935],[-8836,-1930],[-8839,-1929],[-8843,-1922],[-8843,-1917],[-8835,-1911],[-8832,-1906],[-8827,-1903],[-8823,-1898],[-8819,-1895],[-8808,-1893],[-8805,-1890],[-8806,-1882],[-8814,-1874],[-8822,-1873],[-8823,-1871],[-8821,-1868],[-8819,-1861],[-8814,-1853],[-8787,-1853],[-8777,-1851],[-8771,-1846],[-8763,-1838],[-8756,-1826],[-8750,-1819],[-8749,-1811],[-8753,-1805],[-8765,-1798],[-8772,-1797],[-8778,-1796],[-8779,-1793],[-8776,-1790],[-8759,-1783],[-8751,-1777],[-8747,-1769],[-8742,-1761],[-8741,-1747],[-8737,-1743],[-8737,-1736],[-8742,-1733],[-8752,-1737],[-8759,-1735],[-8774,-1742],[-8797,-1741],[-8811,-1736],[-8812,-1722],[-8808,-1719],[-8806,-1704],[-8812,-1694],[-8813,-1682],[-8822,-1673],[-8832,-1670],[-8838,-1669],[-8839,-1656],[-8832,-1642],[-8835,-1627],[-8834,-1616],[-8836,-1606],[-8839,-1600],[-8845,-1596],[-8850,-1587],[-8852,-1582],[-8861,-1577],[-8862,-1566],[-8881,-1573],[-8897,-1571],[-8901,-1513],[-8908,-1506],[-8905,-1490],[-8896,-1483],[-8884,-1480],[-8868,-1485],[-8852,-1493],[-8838,-1518],[-8804,-1534],[-8792,-1543],[-8785,-1545],[-8781,-1517],[-8762,-1487],[-8737,-1474],[-8720,-1516],[-8690,-1513],[-8677,-1517],[-8658,-1543],[-8629,-1556],[-8625,-1550],[-8612,-1549],[-8612,-1537],[-8597,-1523],[-8580,-1523],[-8578,-1516],[-8566,-1513],[-8559,-1503],[-8552,-1498],[-8532,-1487],[-8532,-1477],[-8525,-1474],[-8512,-1456],[-8499,-1446],[-8492,-1436],[-8523,-1405],[-8511,-1404],[-8511,-1402],[-8504,-1400],[-8502,-1388],[-8501,-1375],[-8495,-1369],[-8486,-1365],[-8487,-1358],[-8490,-1355],[-8492,-1350],[-8492,-1343],[-8485,-1340],[-8472,-1341],[-8467,-1343],[-8337,-1229],[-8353,-1221],[-8359,-1216],[-8360,-1202],[-8352,-1190],[-8352,-1176],[-8367,-1170],[-8391,-1160],[-8403,-1159],[-8412,-1156],[-8414,-1148],[-8422,-1142],[-8451,-1126],[-8446,-1104],[-8459,-1097],[-8485,-1090],[-8486,-1083],[-8512,-1083],[-8537,-1083],[-8575,-1069],[-8622,-1020],[-8664,-980],[-8711,-852],[-8693,-819],[-8668,-778],[-8653,-725],[-8639,-715],[-8615,-722],[-8591,-712],[-8576,-698],[-8561,-707],[-8542,-715],[-8521,-690],[-8508,-669],[-8520,-650],[-8516,-626],[-8493,-600],[-8491,-580],[-8506,-538],[-8522,-517],[-8531,-492],[-8515,-463],[-8499,-445],[-8480,-424],[-8461,-442],[-8433,-468],[-8414,-482],[-8393,-461],[-8374,-455],[-8338,-453],[-8313,-414],[-8280,-396],[-8268,-377],[-8254,-368],[-8253,-331],[-8285,-328],[-8313,-306],[-8323,-295],[-8338,-271],[-8356,-244],[-8372,-214],[-8394,-189],[-8413,-173],[-8431,-177],[-8447,-172],[-8450,-151],[-8435,-124],[-8410,-107],[-8396,-55],[-8372,-26],[-8390,-12],[-8418,-16],[-8432,-5],[-8428,26],[-8445,48],[-8458,69],[-8484,92],[-8514,77],[-8541,65],[-8567,83],[-8591,84],[-8611,72],[-8647,126],[-8653,134],[-8679,141],[-8691,143],[-8713,165],[-8700,184],[-8669,185],[-8665,189],[-8647,242],[-8650,259],[-8657,271],[-8673,291],[-8682,304],[-8700,311],[-8724,323],[-8742,317],[-8758,317],[-8776,308],[-8794,311],[-8808,307],[-8822,313],[-8883,303],[-8901,281],[-8910,264],[-8907,228],[-8917,215],[-8960,215],[-8973,194],[-8988,180],[-9013,176],[-9023,189],[-9031,206],[-9048,208],[-9062,190],[-9076,159],[-9089,142],[-9113,128],[-9126,111],[-9139,111],[-9149,103],[-9156,107],[-9166,125],[-9169,129],[-9171,135],[-9178,136],[-9192,148],[-9206,141],[-9216,143],[-9233,163],[-9241,175],[-9255,182],[-9268,196],[-9274,211],[-9294,225],[-9331,194],[-9331,160],[-9346,151],[-9376,116],[-9409,117],[-9439,149],[-9458,144],[-9481,151],[-9505,151],[-9516,159],[-9535,167],[-9561,174],[-9579,197],[-9571,228],[-9576,256],[-9571,274],[-9576,285],[-9557,306],[-9538,333],[-9536,355],[-9586,378],[-9597,391],[-9615,409],[-9643,415],[-9662,407],[-9679,378],[-9721,371],[-9757,380],[-9803,405],[-9835,393],[-9863,366],[-9879,342],[-9896,322],[-9895,287],[-9915,269],[-9967,263],[-10096,272],[-10097,45],[-10096,-496],[-10080,-496],[-10080,-817],[-10064,-816],[-10064,-1008],[-10048,-1008],[-10048,-1152],[-10032,-1152],[-10033,-1296],[-10015,-1295],[-10016,-1409],[-9951,-1867],[-9859,-2279],[-9735,-2761],[-9608,-3144],[-9565,-3129],[-9522,-3110],[-9461,-3131],[-9410,-3100],[-9409,-3082],[-9432,-3064]]},{\"name\":\"Temporal Isles\",\"polygon\":[[-1701,-6351],[-1696,-6301],[-1732,-6271],[-1724,-6239],[-1697,-6190],[-1665,-6190],[-1652,-6175],[-1404,-6175],[-1390,-6215],[-1263,-6215],[-1246,-6193],[-1222,-6177],[-1223,-6158],[-1223,-6142],[-1218,-6132],[-1216,-6121],[-1208,-6110],[-1199,-6099],[-1186,-6092],[-1172,-6090],[-1157,-6092],[-1143,-6095],[-1137,-6093],[-1125,-6082],[-1113,-6073],[-1101,-6073],[-1088,-6069],[-1084,-6063],[-1083,-6052],[-1083,-6041],[-1089,-6032],[-1109,-6030],[-1126,-6020],[-1144,-6006],[-1157,-5994],[-1155,-5986],[-1148,-5980],[-1113,-5967],[-1103,-5950],[-1105,-5924],[-1174,-5848],[-1240,-5779],[-1248,-5746],[-1278,-5736],[-1295,-5720],[-1314,-5711],[-1335,-5731],[-1367,-5744],[-1427,-5745],[-1482,-5730],[-1649,-5547],[-1777,-5481],[-1890,-5595],[-2001,-5679],[-2024,-5828],[-2034,-5985],[-2032,-6113],[-2025,-6245],[-2006,-6328],[-1917,-6359],[-1881,-6393],[-1864,-6446],[-1836,-6473],[-1845,-6513],[-1833,-6532],[-1806,-6525],[-1780,-6510],[-1768,-6494],[-1776,-6465],[-1746,-6445],[-1737,-6423],[-1708,-6394]]},{\"name\":\"Khione\",\"polygon\":[[-4733,6997],[-4727,6983],[-4692,6964],[-4670,6947],[-4655,6929],[-4658,6899],[-4670,6879],[-4694,6865],[-4713,6847],[-4716,6836],[-4709,6820],[-4693,6805],[-4689,6795],[-4695,6786],[-4693,6761],[-4685,6754],[-4667,6753],[-4661,6751],[-4649,6737],[-4646,6703],[-4632,6684],[-4611,6661],[-4589,6648],[-4551,6636],[-4546,6629],[-4552,6601],[-4588,6568],[-4590,6548],[-4583,6529],[-4585,6520],[-4603,6503],[-4605,6481],[-4593,6470],[-4571,6462],[-4552,6444],[-4515,6448],[-4338,6521],[-4335,6512],[-4329,6502],[-4324,6497],[-4315,6497],[-4313,6498],[-4311,6498],[-4304,6485],[-4294,6479],[-4289,6477],[-4272,6492],[-4260,6491],[-4235,6500],[-4223,6498],[-4212,6486],[-4206,6465],[-4197,6460],[-4180,6461],[-4172,6471],[-4166,6483],[-4154,6518],[-4134,6555],[-4121,6562],[-4104,6574],[-4086,6586],[-4087,6597],[-4110,6618],[-4112,6744],[-4087,6765],[-4087,6773],[-4087,6805],[-4087,6938],[-4089,6940],[-4104,6930],[-4115,6921],[-4128,6912],[-4143,6918],[-4158,6920],[-4167,6924],[-4182,6936],[-4191,6955],[-4188,6968],[-4175,6991],[-4178,6993],[-4729,6997]]},{\"name\":\"Mushroom Island\",\"polygon\":[[-5298,765],[-5400,700],[-5461,752],[-5487,789],[-5505,828],[-5533,876],[-5507,946],[-5398,1017],[-5299,952],[-5230,870]]},{\"name\":\"Boartal Portal Area\",\"polygon\":[[-7770,-315],[-7670,-315],[-7670,-215],[-7770,-215]]}]},{\"name\":\"Cortesia Del Mar\",\"id\":\"9406988d-caac-492d-bfe2-0639a85c3d36\",\"color\":\"#2F9AFF\",\"notes\":\"Cortesia Del Mar became a State of Icenia on the 23rd September, 2024 via the Grant of Statehood to the Alenarith Protectorate (AP)\",\"subregions\":[{\"name\":\"Arsenio\",\"polygon\":[[2070,5363],[2277,5364],[2434,5289],[2430,5261],[2486,5235],[2515,5230],[2527,5208],[2528,5177],[2565,5125],[2594,5102],[2599,5059],[2552,5037],[2582,4992],[2574,4961],[2589,4952],[2608,4958],[2647,4940],[2666,4917],[2682,4884],[2701,4861],[2681,4833],[2693,4814],[2722,4810],[2744,4785],[2743,4752],[2780,4739],[2853,4803],[2894,4779],[2897,4733],[2954,4677],[3169,4677],[3168,4290],[3192,4230],[3076,4177],[3041,4168],[3029,4130],[2951,4100],[2950,4028],[2978,3999],[2955,3916],[2880,3848],[2638,3588],[2471,3571],[2215,3602],[2160,3495],[2022,3457],[1947,3557],[1910,3744],[1969,3870],[1887,4010],[1834,3942],[1740,3968],[1563,4091],[1458,4069],[1335,4147],[1414,4365],[1416,4487],[1463,4517],[1570,4362],[1790,4428],[1774,4536],[1808,4642],[1872,4666],[1952,4652],[2000,4698],[1939,4767],[1995,4832],[1943,4948],[2009,5027],[2069,5034]]},{\"name\":\"Monterrey\",\"polygon\":[[6911,1316],[7221,972],[7518,970],[7605,905],[7664,897],[7661,840],[7699,814],[7752,832],[7769,775],[7818,784],[7833,771],[7905,823],[7959,824],[7974,757],[8006,797],[8038,797],[8051,843],[8083,851],[8091,926],[8092,1020],[8066,1065],[8051,1065],[8030,1045],[8013,1075],[7988,1099],[7992,1139],[7985,1158],[8008,1195],[8027,1225],[8018,1257],[8034,1279],[8057,1284],[8095,1330],[8122,1388],[8175,1399],[8211,1419],[8203,1443],[8223,1447],[8232,1510],[8211,1518],[8183,1603],[8147,1601],[8096,1573],[8009,1578],[7998,1529],[8015,1497],[7923,1455],[7915,1418],[7875,1395],[7801,1467],[7752,1467],[7729,1437],[7728,1405],[7704,1402],[7672,1443],[7675,1473],[7630,1492],[7578,1485],[7559,1502],[7598,1534],[7610,1559],[7575,1573],[7501,1533],[7471,1509],[7396,1545],[7353,1476],[7306,1469],[7265,1427],[7239,1416],[7207,1373],[7058,1315],[7048,1289]]},{\"name\":\"Iaumea\",\"polygon\":[[6089,2624],[6179,2543],[6193,2488],[6343,2404],[6374,2441],[6481,2384],[6497,2355],[6539,2356],[6582,2304],[6534,2192],[6485,2182],[6482,2150],[6538,2075],[6647,1992],[6677,1916],[6782,1858],[6767,1768],[6804,1702],[6942,1729],[7070,1791],[7055,1865],[7119,1877],[7122,1901],[7099,1920],[7171,2010],[7233,2057],[7267,2040],[7296,2060],[7328,2090],[7384,2099],[7393,2129],[7426,2139],[7437,2169],[7480,2184],[7519,2160],[7543,2223],[7599,2264],[7639,2287],[7637,2305],[7516,2343],[7430,2357],[7363,2392],[7318,2452],[7298,2510],[7258,2646],[7202,2770],[7153,2856],[7035,2885],[7001,2931],[6918,2963],[6876,2991],[6817,2993],[6782,3053],[6835,3074],[6835,3112],[6733,3202],[6657,3304],[6676,3355],[6639,3382],[6592,3386],[6566,3406],[6500,3357],[6420,3389],[6386,3426],[6454,3488],[6434,3531],[6399,3609],[6216,3624],[6152,3539],[6169,3388],[6098,3122],[6150,3017],[6104,2893],[6017,2871],[6014,2780],[6092,2717],[6078,2651]]},{\"name\":\"Ipta\",\"polygon\":[[4400,6404],[4407,6374],[4464,6324],[4525,6409],[4533,6443],[4589,6475],[4629,6438],[4707,6386],[4740,6466],[4726,6498],[4780,6531],[4842,6517],[4915,6572],[4953,6557],[4963,6515],[4999,6512],[5018,6475],[5098,6481],[5149,6415],[5213,6413],[5345,6535],[5340,6594],[5286,6618],[5257,6673],[5178,6704],[5148,6764],[5088,6788],[5034,6857],[4951,6884],[4893,6858],[4868,6795],[4836,6770],[4815,6800],[4805,6847],[4756,6861],[4693,6860],[4657,6815],[4658,6754],[4627,6721],[4648,6636],[4596,6569],[4495,6534],[4455,6455]]}]},{\"name\":\"Riemark\",\"id\":\"878b53b7-0148-40cb-8649-7bf646800282\",\"color\":\"#FFFF55\",\"notes\":\"Selsey became a State of Icenia on the 9th July, 2024 via the Mandate of Selsey\",\"subregions\":[{\"name\":\"Riemark\",\"polygon\":[[-3369,-4905],[-3395,-4947],[-3362,-4973],[-3315,-4979],[-3347,-5100],[-3374,-5146],[-3392,-5206],[-3348,-5251],[-3297,-5239],[-3254,-5265],[-3223,-5282],[-3193,-5321],[-3157,-5363],[-3114,-5400],[-3102,-5465],[-3045,-5467],[-2976,-5432],[-2909,-5264],[-2829,-5237],[-2731,-5227],[-2654,-5196],[-2563,-5194],[-2448,-5131],[-2370,-4998],[-2456,-4834],[-2579,-4706],[-2803,-4703],[-2890,-4721],[-2929,-4729],[-2980,-4748],[-3025,-4787],[-3114,-4778],[-3121,-4827],[-3189,-4885],[-3281,-4901],[-3334,-4900]]}]}]";

    document.addEventListener('DOMContentLoaded', () => {
        const territories = JSON.parse(territoriesJson);
        
        // CivMC tile server uses custom URL format:
        // https://civmc-map.duckdns.org/tiles/terrain/z{zoom}/{x},{z}.png
        // Tiles are 256x256 pixels, at zoom 0 each tile covers 256 blocks
        // Minecraft coords: x increases east, z increases south
        
        // For Leaflet Simple CRS, we'll use [z, x] directly
        // This means north is negative z (up on screen), south is positive z (down)
        // But Leaflet y increases upward, so we need to handle this
        
        // Convert Minecraft [x, z] to Leaflet [lat, lng]
        // We use z directly for lat, x for lng
        // The map will appear "upside down" from typical Leaflet usage
        // but will match CivMC orientation (north = up requires negative z)
        function mcToLatLng(x, z) {
            // Use z for lat (vertical), x for lng (horizontal)
            // Negate z so north (negative MC z) is up (positive Leaflet y)
            if (typeof x !== 'number' || typeof z !== 'number' || isNaN(x) || isNaN(z)) {
                console.error('Invalid coord:', x, z);
                return [0, 0];
            }
            return [-z, x];
        }
        
        // Convert a polygon ring from MC coords to Leaflet coords
        function convertRing(ring) {
            if (!Array.isArray(ring)) {
                console.error('convertRing called with non-array:', ring);
                return [];
            }
            return ring.map(coord => {
                if (!Array.isArray(coord) || coord.length < 2) {
                    console.error('Invalid coord in ring:', coord);
                    return [0, 0];
                }
                const [x, z] = coord;
                return mcToLatLng(x, z);
            });
        }
        
        // Check if polygon data is multi-ring (has holes)
        // Single ring: [[x,z], [x,z], ...] - first element is [number, number]
        // Multi-ring: [[[x,z], ...], [[x,z], ...]] - first element is array of [number, number]
        function isMultiRing(polygon) {
            return Array.isArray(polygon[0]) && Array.isArray(polygon[0][0]);
        }
        
        // Convert polygon (single or multi-ring) to Leaflet format
        // For Leaflet L.polygon():
        // - Simple polygon: [[lat,lng], [lat,lng], ...]
        // - Polygon with holes: [[[lat,lng]...], [[lat,lng]...]] where first is outer, rest are holes
        function convertPolygon(polygon) {
            if (!polygon || !Array.isArray(polygon) || polygon.length === 0) {
                console.error('Invalid polygon data:', polygon);
                return [];
            }
            
            // Debug: log first few coords to understand format
            // console.log('Converting polygon, first elem:', polygon[0], 'isMultiRing:', isMultiRing(polygon));
            
            if (isMultiRing(polygon)) {
                // Multi-ring polygon (with holes): convert each ring
                // Returns format: [[[lat,lng]...], [[lat,lng]...], ...]
                const result = polygon.map(ring => convertRing(ring));
                // console.log('Multi-ring result structure:', result.length, 'rings');
                return result;
            } else {
                // Single ring: return as simple polygon format [[lat,lng], [lat,lng], ...]
                const result = convertRing(polygon);
                // console.log('Single-ring result, points:', result.length);
                return result;
            }
        }
        
        // Initialize map with Simple CRS (no projection, just pixel coords)
        const map = L.map('icenia-map', {
            crs: L.CRS.Simple,
            minZoom: -5,
            maxZoom: 0,
            zoomSnap: 0.5,
            zoomDelta: 0.5,
            attributionControl: false
        });
        
        // Set an initial view - required before adding layers to prevent clipping errors
        // This will be overwritten by fitBounds later
        map.setView([0, 0], -3);
        
        // Custom tile layer for CivMC with correct URL format
        // CivMC tiles: z{zoom}/{x},{z}.png where x,z are tile indices
        // At zoom level z, each tile covers 256 * 2^(-z) blocks
        // Tile (0,0) at zoom 0 covers world blocks (0-255, 0-255)
        const CivMCTileLayer = L.TileLayer.extend({
            getTileUrl: function(coords) {
                const zoom = coords.z;
                // Leaflet tile coords at this zoom
                // coords.x = horizontal tile index
                // coords.y = vertical tile index (increases downward in Leaflet internals)
                // 
                // Our coordinate mapping: lat = -mcZ, lng = mcX
                // So Leaflet's y (which represents lat) = -mcZ
                // Therefore: mcZ = -lat
                // 
                // For tiles, Leaflet y increases "downward" in tile coordinates
                // but we've mapped lat = -z, so larger y = larger -z = smaller z (more north)
                // We need to flip: tileZ = -coords.y - 1
                const tileX = coords.x;
                const tileZ = coords.y;
                return `https://civmc-map.duckdns.org/tiles/terrain/z${zoom}/${tileX},${tileZ}.png`;
            }
        });
        
        // Add the custom tile layer
        new CivMCTileLayer('', {
            minZoom: -5,
            maxZoom: 0,
            maxNativeZoom: 0,
            minNativeZoom: -5,
            tileSize: 256,
            noWrap: true,
            errorTileUrl: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII='
        }).addTo(map);
        
        // Add attribution
        L.control.attribution({
            prefix: '<a href="https://map.civinfo.net" target="_blank">CivMap</a>'
        }).addTo(map);
        
        // Store polygon layers for interaction
        const polygonLayers = new Map();
        
        // Add territory polygons from subregions
        territories.forEach(territory => {
            if (!territory.subregions || territory.subregions.length === 0) return;
            
            // Filter to non-cutout subregions for main territory display
            const mainSubregions = territory.subregions.filter(sr => !sr.isCutout);
            if (mainSubregions.length === 0) return;
            
            // Create polygons from all non-cutout subregions
            // Each subregion can have a single ring or multiple rings (with holes)
            const polygons = [];
            mainSubregions.forEach(sr => {
                try {
                    const latLngs = convertPolygon(sr.polygon);
                    if (!latLngs || latLngs.length === 0) {
                        console.warn(`Empty polygon for ${territory.name} - ${sr.name}`);
                        return;
                    }
                    const poly = L.polygon(latLngs, {
                        color: territory.color,
                        weight: 2,
                        opacity: 0.8,
                        fillColor: territory.color,
                        fillOpacity: 0.35,
                        className: 'territory-layer'
                    });
                    
                    // Add tooltip with subregion name directly to each polygon
                    poly.bindTooltip(sr.name, {
                        permanent: false,
                        direction: 'center',
                        className: 'subregion-tooltip'
                    });
                    
                    polygons.push(poly);
                } catch (e) {
                    console.error(`Error creating polygon for ${territory.name} - ${sr.name}:`, e, sr.polygon);
                }
            });
            
            if (polygons.length === 0) return;
            
            // Create a feature group for this territory
            const group = L.featureGroup(polygons).addTo(map);
            polygonLayers.set(territory.id, group);
            
            // Store territory data for info panel
            group.territoryData = territory;
            
            // Hover effects for main territory (only when not selected)
            group.on('mouseover', () => {
                if (selectedTerritoryId !== territory.id) {
                    // Make polygon more opaque (less see-through) on hover
                    group.setStyle({
                        fillOpacity: 0.65,
                        weight: 3,
                        color: '#ffffff'
                    });
                    group.bringToFront();
                }
                // Show territory info in panel on hover
                showInfoPanel(territory);
                // Dim tiles on hover
                setTilesDimmed(true);
            });
            
            group.on('mouseout', () => {
                if (selectedTerritoryId !== territory.id) {
                    // If a territory is selected, hide this one (mask covers it)
                    // Otherwise restore normal opacity
                    group.setStyle({
                        fillOpacity: selectedTerritoryId ? 0 : 0.35,
                        weight: selectedTerritoryId ? 0 : 2,
                        opacity: selectedTerritoryId ? 0 : 0.8,
                        color: territory.color
                    });
                }
                // If no territory is selected, show placeholder
                if (!selectedTerritoryId) {
                    hideInfoPanel();
                } else {
                    // Show the selected territory's info
                    const selectedTerritory = territories.find(t => t.id === selectedTerritoryId);
                    if (selectedTerritory) {
                        showInfoPanel(selectedTerritory);
                    }
                }
                // Restore tile brightness (unless a territory is selected)
                if (!selectedTerritoryId) {
                    setTilesDimmed(false);
                }
            });
            
            // Click to select territory - zoom to the specific subregion clicked
            group.on('click', (e) => {
                L.DomEvent.stopPropagation(e);
                // Get the bounds of the specific polygon (subregion) that was clicked
                const clickedLayer = e.layer || e.target;
                const subregionBounds = clickedLayer && clickedLayer.getBounds ? clickedLayer.getBounds() : null;
                selectTerritory(territory.id, subregionBounds);
            });
        });
        
        // Track selected territory
        let selectedTerritoryId = null;
        let initialBounds = null;
        
        // Fit map to show all territories
        const allBounds = [];
        polygonLayers.forEach(group => {
            allBounds.push(group.getBounds());
        });
        if (allBounds.length > 0) {
            const combinedBounds = allBounds.reduce((acc, bounds) => acc.extend(bounds), allBounds[0]);
            initialBounds = combinedBounds;
            map.fitBounds (combinedBounds, { padding: [20, 20], animate: true });
        } else {
            // Default view centered on Icenia City (approx -3900, -4600)
            map.setView(mcToLatLng(-3900, -4600), -1);
        }
        
        // Info panel functions
        const infoPanel = document.getElementById('info-panel-content');
        
        function showInfoPanel(territory) {
            if (!infoPanel) return;
            
            const displaySubregions = territory.subregions ? territory.subregions.filter(sr => !sr.isCutout) : [];
            
            let html = `
                <div class="info-panel-header">
                    <div class="info-panel-color" style="background-color: ${territory.color};"></div>
                    <h3 class="info-panel-title">${territory.name}</h3>
                </div>`;
            
            if (territory.notes) {
                html += `<div class="info-panel-notes">${territory.notes}</div>`;
            }
            
            if (displaySubregions.length > 1) {
                html += `<div class="info-panel-subregions">
                    <div class="info-panel-subregions-title">Regions</div>`;
                displaySubregions.forEach(sr => {
                    html += `<div class="info-panel-subregion">‚Ä¢ ${sr.name}</div>`;
                });
                html += `</div>`;
            }
            
            infoPanel.innerHTML = html;
        }
        
        function hideInfoPanel() {
            if (!infoPanel) return;
            infoPanel.innerHTML = '<div class="info-placeholder">Hover over a territory to see details</div>';
        }
        
        // Tile dimming/brightening helper functions
        const mapContainer = document.querySelector('.leaflet-map-container');
        function setTilesDimmed(dimmed) {
            if (mapContainer) {
                if (dimmed) {
                    mapContainer.classList.add('territory-hover');
                } else {
                    mapContainer.classList.remove('territory-hover');
                }
            }
        }
        
        function setTilesSelected(selected) {
            if (mapContainer) {
                if (selected) {
                    mapContainer.classList.remove('territory-hover');
                    mapContainer.classList.add('territory-selected');
                } else {
                    mapContainer.classList.remove('territory-selected');
                }
            }
        }
        
        // Mask overlay for selected territory (covers area outside the polygon)
        let maskOverlay = null;
        let cutoutOverlays = []; // Separate overlays for polygon cutouts
        
        function createMaskOverlay(territory, selectedGroup) {
            // Remove existing mask
            removeMaskOverlay();
            
            // Use original territory data to build the mask
            // This is more reliable than extracting from Leaflet layers
            const outerRings = [];  // These become holes in the mask (reveal the territory)
            const innerRings = [];  // These are holes within polygons that need to be filled back
            
            // Process all non-cutout subregions from the original territory data
            const mainSubregions = territory.subregions?.filter(sr => !sr.isCutout) || [];
            
            mainSubregions.forEach(sr => {
                if (!sr.polygon || !Array.isArray(sr.polygon) || sr.polygon.length === 0) return;
                
                if (isMultiRing(sr.polygon)) {
                    // Multi-ring polygon: first ring is outer, rest are holes
                    // Outer ring becomes a hole in the mask (reveals territory)
                    outerRings.push(convertRing(sr.polygon[0]));
                    // Inner rings (holes in the polygon) need to be filled back in
                    for (let i = 1; i < sr.polygon.length; i++) {
                        innerRings.push(convertRing(sr.polygon[i]));
                    }
                } else {
                    // Single ring polygon
                    outerRings.push(convertRing(sr.polygon));
                }
            });
            
            // Create a huge outer boundary (covers the whole map)
            const outerBounds = [
                [90000, -90000],   // far north-west
                [90000, 90000],    // far north-east  
                [-90000, 90000],   // far south-east
                [-90000, -90000]   // far south-west
            ];
            
            // Create main mask polygon with holes for the territory outer rings
            // This reveals the territory areas
            const maskCoords = [outerBounds, ...outerRings];
            
            maskOverlay = L.polygon(maskCoords, {
                color: 'transparent',
                weight: 0,
                fillColor: territory.color,
                fillOpacity: 0.45,
                interactive: false,
                className: 'territory-mask'
            }).addTo(map);
            
            // Create separate filled polygons for each inner ring (hole within a polygon)
            // These cover up the cutout areas that were revealed by the outer ring holes
            innerRings.forEach(ring => {
                const cutoutOverlay = L.polygon(ring, {
                    color: 'transparent',
                    weight: 0,
                    fillColor: territory.color,
                    fillOpacity: 0.45,
                    interactive: false,
                    className: 'territory-mask-cutout'
                }).addTo(map);
                cutoutOverlays.push(cutoutOverlay);
            });
        }
        
        function removeMaskOverlay() {
            if (maskOverlay) {
                map.removeLayer(maskOverlay);
                maskOverlay = null;
            }
            // Remove all cutout overlays
            cutoutOverlays.forEach(overlay => {
                map.removeLayer(overlay);
            });
            cutoutOverlays = [];
        }
        
        // Select territory function
        // zoomBounds: optional bounds to zoom to (for subregion-specific zoom when clicking polygon)
        // If not provided, zooms to full territory bounds (for legend clicks)
        function selectTerritory(territoryId, zoomBounds = null) {
            const legendItems = document.querySelectorAll('.legend-item');
            
            // If clicking the same territory, deselect
            if (selectedTerritoryId === territoryId) {
                deselectTerritory();
                return;
            }
            
            selectedTerritoryId = territoryId;
            const selectedGroup = polygonLayers.get(territoryId);
            
            if (!selectedGroup) return;
            
            // Show territory info in panel
            const territory = territories.find(t => t.id === territoryId);
            if (territory) {
                showInfoPanel(territory);
            }
            
            // Update all polygon styles
            polygonLayers.forEach((group, id) => {
                if (id === territoryId) {
                    // Selected territory: nearly transparent to see map inside, white border
                    group.setStyle({
                        fillOpacity: 0,
                        weight: 4,
                        opacity: 1,
                        color: '#ffffff'
                    });
                    // Bring selected territory to front
                    group.bringToFront();
                    // Add pulse class for animation
                    group.eachLayer(layer => {
                        if (layer._path) {
                            layer._path.classList.add('territory-pulse');
                            setTimeout(() => layer._path.classList.remove('territory-pulse'), 600);
                        }
                    });
                } else {
                    // Other territories: dimmed, restore original color
                    const otherTerritory = territories.find(t => t.id === id);
                    group.setStyle({
                        fillOpacity: 0,
                        weight: 0,
                        opacity: 0,
                        color: otherTerritory ? otherTerritory.color : group.territoryData?.color
                    });
                }
            });
            
            // Create mask overlay to tint areas outside the selected territory
            createMaskOverlay(territory, selectedGroup);
            
            // Zoom to selected area with animation
            // Use zoomBounds if provided (subregion click), otherwise use full territory bounds (legend click)
            const boundsToZoom = zoomBounds || selectedGroup.getBounds();
            
            // Calculate offset to account for the legend panel on the right
            const mapDiv = document.getElementById('icenia-map');
            const legendDiv = document.getElementById('map-legend');
            const legendWidth = legendDiv ? legendDiv.offsetWidth : 200;
            const mapWidth = mapDiv ? mapDiv.offsetWidth : 800;
            
            // Calculate padding: more on the right to shift view left
            const rightPadding = legendWidth + 30; // legend width + some margin
            const leftPadding = 50;
            const verticalPadding = 50;
            
            map.flyToBounds(boundsToZoom, { 
                paddingTopLeft: [leftPadding, verticalPadding],
                paddingBottomRight: [rightPadding, verticalPadding],
                animate: true,
                maxZoom: -1,
                duration: 0.3,
            });
            
            // Update legend highlight
            legendItems.forEach(item => {
                if (item.getAttribute('data-id') === territoryId) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            // Brighten tiles when territory is selected
            setTilesSelected(true);
        }
        
        // Deselect territory function
        function deselectTerritory() {
            if (!selectedTerritoryId) return;
            
            selectedTerritoryId = null;
            const legendItems = document.querySelectorAll('.legend-item');
            
            // Remove mask overlay
            removeMaskOverlay();
            
            // Reset all polygon styles to original colors
            polygonLayers.forEach((group, id) => {
                const territory = territories.find(t => t.id === id);
                group.setStyle({
                    fillOpacity: 0.35,
                    weight: 2,
                    opacity: 0.8,
                    color: territory ? territory.color : group.territoryData?.color
                });
            });
            
            // Reset info panel
            hideInfoPanel();
            
            // Zoom back to show all territories
            if (initialBounds) {
                map.flyToBounds(initialBounds, { 
                    padding: [20, 20],
                    animate: true,
                    duration: 0.3
                });
            }
            
            // Clear legend highlight
            legendItems.forEach(item => item.classList.remove('active'));
            
            // Remove tile selection state
            setTilesSelected(false);
        }
        
        // Click on map background to deselect
        map.on('click', () => {
            deselectTerritory();
        });
        
        // Legend interaction
        const legendItems = document.querySelectorAll('.legend-item');
        legendItems.forEach(item => {
            const id = item.getAttribute('data-id');
            
            item.addEventListener('click', () => {
                selectTerritory(id);
            });
            
            item.addEventListener('mouseenter', () => {
                const group = polygonLayers.get(id);
                if (group && selectedTerritoryId !== id) {
                    // Make polygon more opaque (less see-through) on hover
                    group.setStyle({
                        fillOpacity: 0.65,
                        weight: 4,
                        color: '#ffffff'
                    });
                    group.bringToFront();
                }
                // Show territory info in panel on legend hover
                const territory = territories.find(t => t.id === id);
                if (territory) {
                    showInfoPanel(territory);
                }
                // Dim tiles on legend hover (only if no territory selected)
                if (!selectedTerritoryId) {
                    setTilesDimmed(true);
                }
            });
            
            item.addEventListener('mouseleave', () => {
                const group = polygonLayers.get(id);
                if (group && selectedTerritoryId !== id) {
                    const territory = territories.find(t => t.id === id);
                    // If a territory is selected, hide this one again (mask covers it)
                    // Otherwise restore normal opacity
                    group.setStyle({
                        fillOpacity: selectedTerritoryId ? 0 : 0.35,
                        weight: selectedTerritoryId ? 0 : 2,
                        opacity: selectedTerritoryId ? 0 : 0.8,
                        color: territory ? territory.color : group.territoryData?.color
                    });
                }
                // Reset info panel if no territory selected
                if (!selectedTerritoryId) {
                    hideInfoPanel();
                } else {
                    // Show selected territory's info
                    const selectedTerritory = territories.find(t => t.id === selectedTerritoryId);
                    if (selectedTerritory) {
                        showInfoPanel(selectedTerritory);
                    }
                }
                // Restore tile brightness (unless a territory is selected)
                if (!selectedTerritoryId) {
                    setTilesDimmed(false);
                }
            });
        });
        
        // Custom scroll indicator helper function
        function setupScrollIndicator(scrollEl, indicatorEl) {
            if (!scrollEl || !indicatorEl) return;
            
            const scrollThumb = indicatorEl.querySelector('.scroll-thumb');
            
            function updateScrollIndicator() {
                const { scrollTop, scrollHeight, clientHeight } = scrollEl;
                const scrollableHeight = scrollHeight - clientHeight;
                
                // Hide indicator if no scrolling needed
                if (scrollableHeight <= 0) {
                    indicatorEl.style.display = 'none';
                    return;
                }
                indicatorEl.style.display = 'block';
                
                // Calculate thumb position (0 to 70% to leave room for thumb height)
                const scrollPercent = scrollTop / scrollableHeight;
                const thumbTop = scrollPercent * 70;
                scrollThumb.style.top = thumbTop + '%';
                
                // Add/remove at-bottom class to stop glow animation
                if (scrollPercent > 0.95) {
                    indicatorEl.classList.add('at-bottom');
                } else {
                    indicatorEl.classList.remove('at-bottom');
                }
                
                // Show indicator briefly when scrolling
                indicatorEl.classList.add('visible');
            }
            
            scrollEl.addEventListener('scroll', updateScrollIndicator);
            
            // Initial check
            updateScrollIndicator();
            
            // Return update function for external calls (e.g., when content changes)
            return updateScrollIndicator;
        }
        
        // Setup scroll indicator for legend items
        const legendItemsEl = document.getElementById('legend-items');
        const scrollIndicator = document.getElementById('scroll-indicator');
        setupScrollIndicator(legendItemsEl, scrollIndicator);
        
        // Setup scroll indicator for info panel
        const infoPanelEl = document.getElementById('info-panel-content');
        const scrollIndicatorInfo = document.getElementById('scroll-indicator-info');
        const updateInfoScrollIndicator = setupScrollIndicator(infoPanelEl, scrollIndicatorInfo);
        
        // Update info panel scroll indicator when content changes
        // We need to observe mutations since content is dynamically inserted
        if (infoPanelEl && updateInfoScrollIndicator) {
            const observer = new MutationObserver(() => {
                // Small delay to let content render
                setTimeout(updateInfoScrollIndicator, 50);
            });
            observer.observe(infoPanelEl, { childList: true, subtree: true });
        }
    });
})();</script><div style="margin-top: 15px;" data-astro-cid-xd5vahtb><a href="https://map.civinfo.net/#url=https://civicenia.github.io/government/borders.json" target="_blank" class="btn" data-astro-cid-xd5vahtb>Open in CivMap</a><a href="/government/borders.json" class="btn btn-secondary" data-astro-cid-xd5vahtb>Download Borders JSON</a></div></div><h3 class="govuk-heading-l" style="color: #0b0c0c;" data-astro-cid-xd5vahtb>States and Territories</h3><div style="display: grid; gap: 20px;" data-astro-cid-xd5vahtb><div class="state-card" style="border-left-color: #3AB3DA" data-astro-cid-xd5vahtb><div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 10px;" data-astro-cid-xd5vahtb><div style="display: flex; gap: 15px; align-items: start;" data-astro-cid-xd5vahtb><div class="flag-placeholder" style="background-color: #3AB3DA20;" data-astro-cid-xd5vahtb><img src="/assets/images/flags/icenia.png" alt="Flag of Icenia Federal Territory" class="state-flag" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" data-astro-cid-xd5vahtb><div class="flag-placeholder" style="display: none;" data-astro-cid-xd5vahtb>No flag</div></div><div data-astro-cid-xd5vahtb><h4 class="state-name" data-astro-cid-xd5vahtb>Icenia Federal Territory</h4><p class="state-type" data-astro-cid-xd5vahtb>Federal Territory</p></div></div><div class="color-indicator" style="background-color: #3AB3DA;" data-astro-cid-xd5vahtb></div></div><p class="state-description" data-astro-cid-xd5vahtb>The heartlands of Icenia, encompassing a large portion of the -,- quadrant. Stretches from lush forests and snowy mountains to sprawling plains and deserts.</p><div class="state-meta" data-astro-cid-xd5vahtb><div data-astro-cid-xd5vahtb><strong style="color: #1C70B8;" data-astro-cid-xd5vahtb>Coordinates:</strong><span style="margin-left: 5px;" data-astro-cid-xd5vahtb>-4554 -4938</span></div></div><p class="state-note" data-astro-cid-xd5vahtb><strong data-astro-cid-xd5vahtb>Note:</strong>Icenia&#39;s original territory established on 15th May 2022</p></div><div class="state-card" style="border-left-color: #1C70B8" data-astro-cid-xd5vahtb><div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 10px;" data-astro-cid-xd5vahtb><div style="display: flex; gap: 15px; align-items: start;" data-astro-cid-xd5vahtb><div class="flag-placeholder" style="background-color: #1C70B820;" data-astro-cid-xd5vahtb><img src="/assets/images/flags/" alt="Flag of Icenia City" class="state-flag" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" data-astro-cid-xd5vahtb><div class="flag-placeholder" style="display: none;" data-astro-cid-xd5vahtb>No flag</div></div><div data-astro-cid-xd5vahtb><h4 class="state-name" data-astro-cid-xd5vahtb>Icenia City</h4><p class="state-type" data-astro-cid-xd5vahtb>Capital Territory</p></div></div><div class="color-indicator" style="background-color: #1C70B8;" data-astro-cid-xd5vahtb></div></div><p class="state-description" data-astro-cid-xd5vahtb>The administrative and economic center of the Republic, hosting key government buildings, bustling markets, and the historic core of Icenian society.</p><div class="state-meta" data-astro-cid-xd5vahtb><div data-astro-cid-xd5vahtb><strong style="color: #1C70B8;" data-astro-cid-xd5vahtb>Coordinates:</strong><span style="margin-left: 5px;" data-astro-cid-xd5vahtb>-3920, -4274</span></div></div><p class="state-note" data-astro-cid-xd5vahtb><strong data-astro-cid-xd5vahtb>Note:</strong>Formed from federal territory on 19th November 2025</p></div><div class="state-card" style="border-left-color: #7030A0" data-astro-cid-xd5vahtb><div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 10px;" data-astro-cid-xd5vahtb><div style="display: flex; gap: 15px; align-items: start;" data-astro-cid-xd5vahtb><div class="flag-placeholder" style="background-color: #7030A020;" data-astro-cid-xd5vahtb><img src="/assets/images/flags/bloom.png" alt="Flag of Bloom" class="state-flag" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" data-astro-cid-xd5vahtb><div class="flag-placeholder" style="display: none;" data-astro-cid-xd5vahtb>No flag</div></div><div data-astro-cid-xd5vahtb><h4 class="state-name" data-astro-cid-xd5vahtb>Bloom</h4><p class="state-type" data-astro-cid-xd5vahtb>State</p></div></div><div class="color-indicator" style="background-color: #7030A0;" data-astro-cid-xd5vahtb></div></div><p class="state-description" data-astro-cid-xd5vahtb>The northernmost state, known for its vibrant communities and diverse biomes ranging from dense forests to icy tundras. Famous for its urban and natural beauty, along with its architectural influences reminiscent of Naboo.</p><div class="state-meta" data-astro-cid-xd5vahtb><div data-astro-cid-xd5vahtb><strong style="color: #1C70B8;" data-astro-cid-xd5vahtb>Coordinates:</strong><span style="margin-left: 5px;" data-astro-cid-xd5vahtb>-5790 232</span></div></div><p class="state-note" data-astro-cid-xd5vahtb><strong data-astro-cid-xd5vahtb>Note:</strong>The Viceroyalty of Bloom became a State of Icenia on 27th June 2022. Petrichor merged into Bloom on 19th March 2023.</p></div><div class="state-card" style="border-left-color: #B22234" data-astro-cid-xd5vahtb><div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 10px;" data-astro-cid-xd5vahtb><div style="display: flex; gap: 15px; align-items: start;" data-astro-cid-xd5vahtb><div class="flag-placeholder" style="background-color: #B2223420;" data-astro-cid-xd5vahtb><img src="/assets/images/flags/icarus.svg" alt="Flag of Icarus" class="state-flag" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" data-astro-cid-xd5vahtb><div class="flag-placeholder" style="display: none;" data-astro-cid-xd5vahtb>No flag</div></div><div data-astro-cid-xd5vahtb><h4 class="state-name" data-astro-cid-xd5vahtb>Icarus</h4><p class="state-type" data-astro-cid-xd5vahtb>State</p></div></div><div class="color-indicator" style="background-color: #B22234;" data-astro-cid-xd5vahtb></div></div><p class="state-description" data-astro-cid-xd5vahtb>Desert and savanna biomes characterize this western frontier. Home to the legendary &#39;Ikea&#39; vault and gateway to the western territories.</p><div class="state-meta" data-astro-cid-xd5vahtb><div data-astro-cid-xd5vahtb><strong style="color: #1C70B8;" data-astro-cid-xd5vahtb>Coordinates:</strong><span style="margin-left: 5px;" data-astro-cid-xd5vahtb>-5790 232</span></div></div><p class="state-note" data-astro-cid-xd5vahtb><strong data-astro-cid-xd5vahtb>Note:</strong>Became a State of Icenia on 28th August 2024 via the Icarus-Icenia Merger</p></div><div class="state-card" style="border-left-color: #2F9AFF" data-astro-cid-xd5vahtb><div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 10px;" data-astro-cid-xd5vahtb><div style="display: flex; gap: 15px; align-items: start;" data-astro-cid-xd5vahtb><div class="flag-placeholder" style="background-color: #2F9AFF20;" data-astro-cid-xd5vahtb><img src="/assets/images/flags/cdm.png" alt="Flag of Cortesia Del Mar" class="state-flag" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" data-astro-cid-xd5vahtb><div class="flag-placeholder" style="display: none;" data-astro-cid-xd5vahtb>No flag</div></div><div data-astro-cid-xd5vahtb><h4 class="state-name" data-astro-cid-xd5vahtb>Cortesia Del Mar</h4><p class="state-type" data-astro-cid-xd5vahtb>State</p></div></div><div class="color-indicator" style="background-color: #2F9AFF;" data-astro-cid-xd5vahtb></div></div><p class="state-description" data-astro-cid-xd5vahtb>Comparatively recently returned sovereign nation that joined the Union. Coastal territory known for its maritime heritage and strategic southern position.</p><div class="state-meta" data-astro-cid-xd5vahtb><div data-astro-cid-xd5vahtb><strong style="color: #1C70B8;" data-astro-cid-xd5vahtb>Coordinates:</strong><span style="margin-left: 5px;" data-astro-cid-xd5vahtb>2449 4460</span></div></div><p class="state-note" data-astro-cid-xd5vahtb><strong data-astro-cid-xd5vahtb>Note:</strong>Became a State of Icenia on 23rd September 2024</p></div><div class="state-card" style="border-left-color: #013201" data-astro-cid-xd5vahtb><div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 10px;" data-astro-cid-xd5vahtb><div style="display: flex; gap: 15px; align-items: start;" data-astro-cid-xd5vahtb><div class="flag-placeholder" style="background-color: #01320120;" data-astro-cid-xd5vahtb><img src="/assets/images/flags/southshire.png" alt="Flag of Southshire" class="state-flag" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" data-astro-cid-xd5vahtb><div class="flag-placeholder" style="display: none;" data-astro-cid-xd5vahtb>No flag</div></div><div data-astro-cid-xd5vahtb><h4 class="state-name" data-astro-cid-xd5vahtb>Southshire</h4><p class="state-type" data-astro-cid-xd5vahtb>State</p></div></div><div class="color-indicator" style="background-color: #013201;" data-astro-cid-xd5vahtb></div></div><p class="state-description" data-astro-cid-xd5vahtb>Historical territory with deep roots in Icenian culture. Home to Castle Batavia and the Batavian Plains. Once an allied and friendly nation to Icenia, later became a state.</p><div class="state-meta" data-astro-cid-xd5vahtb><div data-astro-cid-xd5vahtb><strong style="color: #1C70B8;" data-astro-cid-xd5vahtb>Coordinates:</strong><span style="margin-left: 5px;" data-astro-cid-xd5vahtb>-7042 -4982</span></div></div><p class="state-note" data-astro-cid-xd5vahtb><strong data-astro-cid-xd5vahtb>Note:</strong>Became a State of Icenia on 30th April 2023</p></div><div class="state-card" style="border-left-color: #FFFF55" data-astro-cid-xd5vahtb><div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 10px;" data-astro-cid-xd5vahtb><div style="display: flex; gap: 15px; align-items: start;" data-astro-cid-xd5vahtb><div class="flag-placeholder" style="background-color: #FFFF5520;" data-astro-cid-xd5vahtb><img src="/assets/images/flags/riemark.png" alt="Flag of Riemark" class="state-flag" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" data-astro-cid-xd5vahtb><div class="flag-placeholder" style="display: none;" data-astro-cid-xd5vahtb>No flag</div></div><div data-astro-cid-xd5vahtb><h4 class="state-name" data-astro-cid-xd5vahtb>Riemark</h4><p class="state-type" data-astro-cid-xd5vahtb>State</p></div></div><div class="color-indicator" style="background-color: #FFFF55;" data-astro-cid-xd5vahtb></div></div><p class="state-description" data-astro-cid-xd5vahtb>Originally a small village, later achieved statehood through the Mandate of Selsey.</p><div class="state-meta" data-astro-cid-xd5vahtb><div data-astro-cid-xd5vahtb><strong style="color: #1C70B8;" data-astro-cid-xd5vahtb>Coordinates:</strong><span style="margin-left: 5px;" data-astro-cid-xd5vahtb>-2619 -4993</span></div></div><p class="state-note" data-astro-cid-xd5vahtb><strong data-astro-cid-xd5vahtb>Note:</strong>Became a State of Icenia on 9th July 2024 via the Mandate of Selsey</p></div></div><div class="govuk-grid-row govuk-!-margin-top-6" data-astro-cid-xd5vahtb><div class="govuk-grid-column-one-half" data-astro-cid-xd5vahtb><div class="govuk-inset-text" data-astro-cid-xd5vahtb><h3 class="govuk-heading-s" data-astro-cid-xd5vahtb>Government Officials</h3><p class="govuk-body-s" data-astro-cid-xd5vahtb>
Meet the elected representatives of the Republic.
</p><a href="/government/officials/" class="govuk-link" data-astro-cid-xd5vahtb>View Officials &rarr;</a></div></div><div class="govuk-grid-column-one-half" data-astro-cid-xd5vahtb><div class="govuk-inset-text" data-astro-cid-xd5vahtb><h3 class="govuk-heading-s" data-astro-cid-xd5vahtb>Icenia City</h3><p class="govuk-body-s" data-astro-cid-xd5vahtb>
Explore the capital city of the Republic.
</p><a href="/icenia-city/" class="govuk-link" data-astro-cid-xd5vahtb>Visit Icenia City &rarr;</a></div></div></div> </main> </div>  <script>GOVUKFrontend.initAll()</script> <script>
            (function(){
                const BASE = (document.body && document.body.dataset && document.body.dataset.base) ? document.body.dataset.base : "/";
                if(!BASE) return;
                try {
                    document.querySelectorAll('img[src^="/"], a[href^="/"]')
                        .forEach((el) => {
                            ["src","href"].forEach((attr) => {
                                if(!el.hasAttribute(attr)) return;
                                const val = el.getAttribute(attr);
                                if(!val || !val.startsWith('/')) return;
                                if(val.startsWith(BASE)) return; // already rewritten
                                el.setAttribute(attr, BASE + val.replace(/^\//, ''));
                            });
                        });
                } catch (e) {
                    // noop
                }
            })();
        </script> <script>
            (function(){
                // For each dropdown item, measure both the link and dropdown menu width
                // and set both to the larger of the two
                const dropdownItems = document.querySelectorAll('.icenia-navbar__item');

                function normalize(p){ return p ? p.replace(/\/+$/, '/') : '/'; }

                dropdownItems.forEach(item => {
                    const menu = item.querySelector('.icenia-navbar__dropdown');
                    const parentLink = item.querySelector('.icenia-navbar__link');
                    if (!menu || !parentLink) return;

                    // Make menu measurable without affecting layout
                    const origMenuStyles = {
                        position: menu.style.position || '',
                        visibility: menu.style.visibility || '',
                        display: menu.style.display || '',
                        clipPath: menu.style.clipPath || '',
                        width: menu.style.width || '',
                        minWidth: menu.style.minWidth || ''
                    };
                    
                    menu.style.position = 'absolute';
                    menu.style.visibility = 'hidden';
                    menu.style.display = 'block';
                    menu.style.clipPath = 'none';
                    menu.style.width = 'auto';
                    menu.style.minWidth = '0';

                    // Measure the widest item inside the dropdown menu
                    let maxDropdownWidth = 0;
                    const links = menu.querySelectorAll('a');
                    links.forEach(a => {
                        // Temporarily ensure auto width for measurement
                        const origWidth = a.style.width;
                        a.style.width = 'auto';
                        const w = a.scrollWidth;
                        a.style.width = origWidth;
                        if (w > maxDropdownWidth) maxDropdownWidth = w;
                    });
                    
                    // Also check menu's natural width
                    const menuNaturalWidth = menu.scrollWidth || 0;
                    maxDropdownWidth = Math.max(maxDropdownWidth, menuNaturalWidth);

                    // Measure the parent link's natural width
                    const origLinkStyles = {
                        width: parentLink.style.width || '',
                        minWidth: parentLink.style.minWidth || ''
                    };
                    parentLink.style.width = 'auto';
                    parentLink.style.minWidth = '0';
                    
                    // Force reflow
                    void parentLink.offsetWidth;
                    
                    const linkNaturalWidth = parentLink.scrollWidth || 0;

                    // Determine the final width (the larger of the two)
                    const finalWidth = Math.max(maxDropdownWidth, linkNaturalWidth);

                    // Apply the same width to both elements
                    parentLink.style.width = finalWidth + 'px';
                    parentLink.style.minWidth = finalWidth + 'px';
                    menu.style.width = finalWidth + 'px';
                    menu.style.minWidth = '0'; // No minimum width on dropdown
                   
                    // Restore other menu styles
                    menu.style.position = origMenuStyles.position;
                    menu.style.visibility = origMenuStyles.visibility;
                    menu.style.display = origMenuStyles.display;
                    menu.style.clipPath = origMenuStyles.clipPath;
                });

                // Active-state detection (mark dropdown and matching child link)
                // Note: Only mark child dropdown links active on an exact path match
                // to avoid highlighting the index/parent child when a deeper route is active.
                const currentPathRaw = window.location.pathname || '/';
                const currentPath = normalize(currentPathRaw);

                dropdownItems.forEach(item => {
                    const menuLinks = item.querySelectorAll('.icenia-navbar__dropdown a');
                    let hasActiveChild = false;

                    menuLinks.forEach(link => {
                        const href = link.getAttribute('href');
                        if (!href) return;
                        
                        // Skip external links (different origin) - they should never be marked active
                        try {
                            const linkUrl = new URL(href, window.location.origin);
                            if (linkUrl.origin !== window.location.origin) return;
                        } catch (e) {
                            // If URL parsing fails, skip this link
                            return;
                        }
                        
                        let linkPath;
                        try { linkPath = new URL(href, window.location.origin).pathname; } catch (e) { linkPath = href; }
                        const normLink = normalize(linkPath);

                        // Mark child link active only on exact match (avoid prefix matches like
                        // '/icenia-city/' matching '/icenia-city/laws/')
                        if (normLink === currentPath) {
                            link.classList.add('active');
                            hasActiveChild = true;
                        }
                    });

                    const toggle = item.querySelector('.icenia-navbar__link');
                    // Keep existing behavior for marking the parent item active when the current
                    // path is within that section (so the parent nav shows the active section)
                    if (toggle && toggle.getAttribute('href')) {
                        try {
                            const tPath = new URL(toggle.getAttribute('href'), window.location.origin).pathname.replace(/\/+$/, '/');
                            if (tPath !== '/' && currentPath.startsWith(tPath)) hasActiveChild = true;
                        } catch (e) {
                            // ignore
                        }
                    }

                    if (hasActiveChild) item.classList.add('active');
                });
            })();
        </script> <script>
            // Responsive navbar: horizontal navbar OR slide-out menu
            (function(){
                const navList = document.querySelector('.icenia-navbar__list');
                const navbar = document.querySelector('.icenia-navbar');
                const navContainer = document.querySelector('.icenia-navbar__container');
                const menuToggle = document.getElementById('menuToggle');
                const menuClose = document.getElementById('menuClose');
                const slideMenu = document.getElementById('slideMenu');
                const menuOverlay = document.getElementById('menuOverlay');
                
                if (!navList || !menuToggle || !slideMenu || !navbar) return;
                
                // Measure the total width needed for horizontal navbar
                function measureHorizontalWidth() {
                    let total = 0;
                    const items = navList.querySelectorAll('.icenia-navbar__item');
                    items.forEach(item => {
                        const link = item.querySelector('.icenia-navbar__link');
                        if (link) {
                            // Get computed styles to account for padding
                            const style = window.getComputedStyle(link);
                            const paddingLeft = parseFloat(style.paddingLeft) || 0;
                            const paddingRight = parseFloat(style.paddingRight) || 0;
                            // Use scrollWidth for the content width, which includes padding
                            total += link.scrollWidth;
                        }
                    });
                    return total;
                }
                
                // Get the actual available width in the navbar container
                function getAvailableWidth() {
                    if (!navContainer) return window.innerWidth;
                    
                    const style = window.getComputedStyle(navContainer);
                    const paddingLeft = parseFloat(style.paddingLeft) || 0;
                    const paddingRight = parseFloat(style.paddingRight) || 0;
                    
                    // The container has max-width: 960px, so we need to consider that
                    const maxWidth = 960;
                    const screenWidth = window.innerWidth;
                    
                    // Calculate container width (min of screen width and max-width)
                    let containerWidth = Math.min(screenWidth, maxWidth);
                    
                    // Subtract padding
                    return containerWidth - paddingLeft - paddingRight;
                }
                
                // Check if horizontal navbar fits
                function checkNavbarFit() {
                    // Temporarily ensure navbar is visible for measurement
                    const wasMenuMode = document.body.classList.contains('menu-mode');
                    const wasMenuOpen = slideMenu.classList.contains('is-open');
                    
                    // Remove menu mode temporarily to measure navbar
                    document.body.classList.remove('menu-mode');
                    
                    // Force reflow to ensure styles are applied
                    void navList.offsetWidth;
                    
                    // Wait a tiny bit for styles to settle, then measure
                    const horizontalWidth = measureHorizontalWidth();
                    const availableWidth = getAvailableWidth();
                    
                    
                    // Small tolerance to avoid edge-case flickering
                    const tolerance = 10;
                    
                    const needsMenuMode = horizontalWidth > availableWidth - tolerance;
                    
                    // Debug logging (can be removed in production)
                    // console.log('Horizontal width:', horizontalWidth, 'Available:', availableWidth, 'Needs menu:', needsMenuMode);
                    
                    if (needsMenuMode) {
                        document.body.classList.add('menu-mode');
                    } else {
                        document.body.classList.remove('menu-mode');
                        // Also close the menu if it was open
                        closeMenu();
                    }
                }
                
                // Open slide menu
                function openMenu() {
                    slideMenu.classList.add('is-open');
                    menuOverlay.classList.add('is-visible');
                    menuToggle.classList.add('is-active');
                    menuToggle.setAttribute('aria-expanded', 'true');
                    document.body.classList.add('menu-open');
                }
                
                // Close slide menu
                function closeMenu() {
                    slideMenu.classList.remove('is-open');
                    menuOverlay.classList.remove('is-visible');
                    menuToggle.classList.remove('is-active');
                    menuToggle.setAttribute('aria-expanded', 'false');
                    document.body.classList.remove('menu-open');
                }
                
                // Toggle slide menu
                function toggleMenu() {
                    if (slideMenu.classList.contains('is-open')) {
                        closeMenu();
                    } else {
                        openMenu();
                    }
                }
                
                // Event listeners for menu toggle
                menuToggle.addEventListener('click', toggleMenu);
                menuClose.addEventListener('click', closeMenu);
                menuOverlay.addEventListener('click', closeMenu);
                
                // Handle submenu toggles in slide menu
                const submenuToggles = document.querySelectorAll('.icenia-slide-menu__link.has-children');
                submenuToggles.forEach(toggle => {
                    toggle.addEventListener('click', function() {
                        const submenu = this.nextElementSibling;
                        if (submenu && submenu.classList.contains('icenia-slide-menu__submenu')) {
                            this.classList.toggle('is-expanded');
                            submenu.classList.toggle('is-open');
                        }
                    });
                });
                
                // Close menu on escape key
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && slideMenu.classList.contains('is-open')) {
                        closeMenu();
                        menuToggle.focus();
                    }
                });
                
                // Run on load (with a small delay to ensure styles are loaded)
                // Use requestAnimationFrame to ensure DOM is fully rendered
                requestAnimationFrame(function() {
                    requestAnimationFrame(function() {
                        checkNavbarFit();
                    });
                });
                
                let resizeTimeout;
                window.addEventListener('resize', function() {
                    clearTimeout(resizeTimeout);
                    resizeTimeout = setTimeout(checkNavbarFit, 100);
                });
            })();
        </script> </body> </html>